<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/default}">
<head>
<meta charset="ISO-8859-1" />
<title>Maintenance Log</title>
<th:block layout:fragment="styles">
<link rel="stylesheet" href="../static/css/daterangepicker.min.css"
		th:href="@{/css/daterangepicker.min.css}" />
    <style>

        .autocomplete-suggestions { border: 1px solid #999; background: #FFF; overflow: auto; }
        .autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; font-size:18px}
        .autocomplete-selected { background: #F0F0F0; }
        .autocomplete-suggestions strong { font-weight: bold; color: #3399FF; }
        .autocomplete-group { padding: 2px 5px; }
        .autocomplete-group strong { display: block; border-bottom: 1px solid #000; }
        
        </style>
</th:block>
</head>
<body>

	<div layout:fragment="content">

		<div class="page-content">
			<div class="row">
				<div class="col-xs-12">
					<!-- PAGE CONTENT BEGINS -->
					<div th:if="${message}">
						<h2 class="alert alert-danger" th:text="${message}"/>
					</div>
					<div th:if="${successMessage}">
						<div class="alert alert-success">
							<button type="button" class="close" data-dismiss="alert">
								<i class="ace-icon fa fa-times"></i>
							</button>
							<strong th:text="${successMessage}">Success!</strong> <br />
						</div>
					</div>
					<!-- PAGE CONTENT ENDS -->
				</div>				
			</div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="tabbable">
                        <ul
                            class="nav nav-tabs padding-12 tab-color-blue background-blue"
                            id="myTab4">
                            <li class="active" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
                            	<a data-toggle="tab" href="#maintenanceLog"
                                aria-expanded="true">Maintenance Log</a></li>
                            <li class="" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
                            	<a data-toggle="tab" href="#maintenanceLogList"
                                aria-expanded="false">Maintenance Log List</a></li>
                        </ul>
                        <div class="tab-content">
                            <div id="maintenanceLog" class="tab-pane fade in active"
                             sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
                                <div class="row">
                                    <div class="search-filter-header bg-primary">
                                        <h5 class="widget-title lighter">Enter Account Number
                                            (20 digits)</h5>
                                    </div>
                                    <div class="widget-body">
                                        <div class="widget-main">
                                            <form method="POST" data-toggle="validator" role="form" id="myForm">
                                                <div class="row">
                                                    <div class="col-xs-12 col-sm-6 col-sm-offset-3">
                                                        <div class="input-group form-group">
                                                            <span class="input-group-addon"> <i
                                                                class="ace-icon fa fa-check"></i>
                                                            </span> 
                                                            <input type="text"
                                                                class="form-control"
                                                                name="accountNumber" id="searchAccountNumber" required
                                                                pattern="^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$"
                                                                onblur="this.parentNode.parentNode.style.backgroundColor=/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/.test(this.value)?'inherit':'red'"
                                                                placeholder="Enter account number (20 digits)" maxlength="20"
                                                                data-error="Please fill 20 digit Account No. field.">
                                                            <span class="input-group-btn">
                                                                <button type="submit" class="btn btn-purple btn-sm" id= "idSubmitRenew">
                                                                    <span
                                                                        class="ace-icon fa fa-search icon-on-right bigger-110"></span>
                                                                    Search
                                                                </button>
                                                            </span>
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
            
                                    <div id="details" class="col-sm-12"></div>
                                    
                                    <div class="modal fade" id="myMaintenanceModal" tabindex="-1" role="form" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')"
                                        aria-labelledby="myModalLabel" >
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                    <h2 class="modal-title blue" id="myModalLabel"> Card Maintenance Log Form</h2>
                                                </div>
                                                <div class="modal-body">
                                                    <form th:object="${maintenanceLog}" method="POST" autocomplete="off"
                                                        th:action="@{/cardmaintenancelog}" id="form-maintenanceCard"
                                                        data-toggle="validator" role="form">
               
                                                        <div class="row">
                                                            <div class="form-horizontal">
                                                                <div class="col-xs-12 col-sm-12">
                                                                <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for=""idAccNoRenew""> Account Number<small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                            <div class="input-group">
                                                                                <input id="idAccNoRenew" type="text"
                                                                                    name="accountNumber"
                                                                                    readonly
                                                                                    class="form-control"/>
                                                                            </div>
                                                                        </div>
                                                                        <div class="help-block with-errors"></div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idOldCardNumber"> Old Card Number<small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                            <div class="input-group">
                                                                                <input id="idOldCardNumber" type="text"
                                                                                    name="oldCardNumber"
                                                                                    readonly
                                                                                    class="form-control"/> <span
                                                                                    class="input-group-addon"> <i
                                                                                    class="fa fa-credit-card bigger-110"></i>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="help-block with-errors"></div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idPresentCardNumber"> Present Card Number<small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                            <div class="input-group">
                                                                                <input id="idPresentCardNumber" type="text"
                                                                                    name="cardNumber" required
                                                                                    pattern="^[0-9]{5}$"
																		onblur="this.parentNode.parentNode.style.backgroundColor=/^[0-9]{5}$/.test(this.value)?'inherit':'transparent'"
																		placeholder="Enter last 5 digits of card number"
																		data-error="Fill last 5 digits of card number."
                                                                                    class="form-control"/> <span
                                                                                    class="input-group-addon"> <i
                                                                                    class="fa fa-credit-card bigger-110"></i>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="help-block with-errors"></div>
                                                                    </div>

                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idCustomerAppDate"> Customer's App Date<small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                            <div class="input-group">
                                                                                <input id="idCustomerAppDate" type="text"
                                                                                    name="customerAppDate" data-date-format="YYYY-MM-DD"
                                                                                    placeholder="Select date..." required
                                                                                    class="form-control date-pickerForm"
                                                                                    data-error="Please select Date." /> <span
                                                                                    class="input-group-addon"> <i
                                                                                    class="fa fa-clock-o bigger-110"></i>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="help-block with-errors"></div>
                                                                    </div>
                                                                    
                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idBranchName"> Branch Name<small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                        <select class="form-control select2" id="idBranchName"
                                                                            name="branchName"
                                                                            data-placeholder="Choose Branch..."
                                                                            data-error="Please select Branch field." required>
                                                                            <option value=""></option>
                                                                            <option th:each="branches : ${branchLists}"
                                                                                    th:value="${branches.branchName}"
                                                                                    th:text="${branches.branchName}"
                                                                                    th:selected="${branches.branchName == currentUser.branchName}"></option>
                                                                        </select>  
                                                                        </div>
                                                                        <div class="help-block with-errors"></div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idMaintenanceRequestFor"> Maintenance Request For <small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                                <select class="select2 form-control" name="maintenanceRequestFor"
                                                                            id="idMaintenanceRequestFor" required
                                                                            data-placeholder="Choose maintenance request for..."
                                                                            data-error="Please select Maintenance Request For field.">
                                                                            <option value=""></option>
                                                                            <option value="Card Block (Lost)"> Card Block (Lost) </option>
                                                                            <option value="Card Block (Damage)">Card Block (Damage)</option>
                                                                            <option value="Re_Pin">Re-Pin</option>
                                                                            <option value="Refresh">Refresh</option>
                                                                            <option value="A/C Update">A/C Update</option>
                                                                            <option value="Others">Others</option>
                                                                        </select>
                                                                        <div class="help-block with-errors"></div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idMaintenanceRequestDate"> Maintenance Request Date <small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                            <div class="input-group">
                                                                                <input id="idMaintenanceRequestDate" type="text"
                                                                                    name="maintenanceRequestDate" data-date-format="YYYY-MM-DD"
                                                                                    placeholder="Select date..." required
                                                                                    class="form-control date-pickerForm"
                                                                                    data-error="Please select Date." /> <span
                                                                                    class="input-group-addon"> <i
                                                                                    class="fa fa-clock-o bigger-110"></i>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="help-block with-errors"></div>
                                                                    </div>
                                                                    
                                                                    
                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idMaintenanceRemarks"> Remarks (Maintenance) <small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                                <textarea name="maintenanceRemarks"
                                                                            placeholder="Write the descriptions here..."
                                                                            class="form-control limited" maxlength="1200"
                                                                            id="idMaintenanceRemarks" rows="3" required
                                                                            data-error="Please fill the remarks"></textarea>
                                                                        <div class="help-block with-errors"></div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label class="col-sm-4 control-label no-padding-right"
                                                                            for="idLodgedBy"> Lodged By <small
                                                                            class="red"> *</small> :
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                            <div class="input-group">
                                                                                <input id="idLodgedBy" type="text" name="mlLodgedBy"
                                                                                    class="form-control" th:value="${currentUser.email}"
                                                                                    readonly />
                                                                            </div>
                                                                        </div>
                                                                        <div class="help-block with-errors"></div>
                                                                    </div>
                                                                </div>
            
            
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">
                                                    <button class="btn btn-sm" data-dismiss="modal">
                                                        <i class="ace-icon fa fa-times"></i> Cancel
                                                    </button>
                                                    <button class="btn btn-sm btn-primary" type="submit"
                                                        form="form-maintenanceCard" id="btnSubmit">
                                                        <i class="ace-icon fa fa-check"></i> Save
                                                    </button>
            
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                            
                                </div>
                            </div>

                            <div id="maintenanceLogList" class="tab-pane" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
                                <div class="search-area well well-sm">
									<div class="search-filter-header bg-primary">
										<h5 class="smaller no-margin-bottom">
											<i class="ace-icon fa fa-sliders light-green bigger-130"></i>&nbsp;
											Refine your Search
										</h5>
									</div>
									<div class="space-6"></div>
									<fieldset class="form-inline">
										<div class="col-sm-12">
											<div class="input-group col-xs-10 col-sm-3"> 
											<select class="form-control select2" id="idBranchNameSearch" name="destinationBranch" 
													data-placeholder="Choose Branch..."  required>
														 <option value=""></option>
														 <option th:each="branchList : ${branchLists}"
					                           										 th:value="${branchList.branchName}"
					                          										 th:text="${branchList.branchName}">Branch</option>
													</select>
				                            </div>&nbsp;
											<div class="inline ">
													<label for="idDateRange"> Customer's App Date Range Picker: </label>
													<div class="input-group">
														<span class="input-group-addon"><i
															class="fa fa-calendar bigger-110"></i></span> <input
															class="form-control dateRange" type="text" name="date-range-picker"
															data-date-format="yyyy-mm-dd" id="idDateRange" />
													</div>
											</div>
										</div>
									</fieldset>
								</div>							
								<div class="row table-responsive">
									<div class="table-header">Card Maintenance Log List</div>
									<table width="100%" id="maintenanceLog-table" aria-hidden="true"
										class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th width="4%" class="detail-col"></th>
												<th width="11%">Customer's App Date</th>
												<th width="12%">A/C Number</th>
												<th width="8%">Present Card Number</th>
												<th width="8%">Old Card Number</th>
												<th width="10%">Maintenance Request For</th>
												<th width="11%">Maintenance Request Date </th>
												<th width="12%">Branch Name </th>
												<th width="14%">Remarks</th>
												<th width="8%"  data-class='hidden'>Logged By</th>
												<th width="8%"  data-class='hidden'>Modified By</th>
												<th width="4%" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR')">Edit</th>
												<th width="4%" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR','CARDSUPERVISOR')">Delete</th>
											</tr>
										</thead>
									</table>
								</div>
                            </div>
                        </div>
                    </div>						
                </div>
            </div>		
		</div>
	</div>
	<th:block layout:fragment="scripts">		
		
	<script>
			
            $(document).ready(function() {
            	

                $('#searchAccountNumber').autocomplete({
                    serviceUrl: '/getTags',
                    paramName: "accountNumber",
                    delimiter: ",",
                    transformResult: function(response) {
                        return {
                            
                            suggestions: $.map($.parseJSON(response), function(item) {
                                
                                return { value: item.accountNumber, data: item.accountNumber };
                            })
                        };
                    }
                });
            });
	</script>
 	<script>
 		$(function() {
 			var start = moment().subtract(29, 'days');
 		    var end = moment();
 		    
 			  $('#idRequestDateRange').daterangepicker({
 				startDate: start,
 		        endDate: end,
 			    opens: 'left',
 			    autoclose: true,
 				todayHighlight: true,
 				ranges: {
 		           'Today': [moment(), moment()],
 		           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
 		           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
 		           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
 		           'This Month': [moment().startOf('month'), moment().endOf('month')],
 		           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
 		        },
 		       locale: {
 	 				format: 'YYYY-MM-DD'
 	 			    }
 			  }, function(start, end, label) {
 				ajaxGetCardRenewByDateBetween(start, end);
 			  });
 			  
 			});
 	</script>  
    
    <script>
        $(document).ready(function() {$("#idSubmitRenew").click(function(e) {
                    e.preventDefault();
                ajaxgetCardRequestByAccNo();
                });
            });
        
        
        function ajaxgetCardRequestByAccNo() {
            let accountNoVal = $('#searchAccountNumber').val();
            const url = '/getcardusers/' + accountNoVal;
            $.getJSON(url, function(data) {
                if(data){
                    createDetailDataTable(data);
                     $("#idAccNoRenew").val(data.accountNumber);
                     $("#idOldCardNumber").val(data.cardNumber);
                     
                }
                else{
                    $('#details').html("<strong class='row' style='color: #d50c56'>* Sorry, no Customer found for given Account Number.</strong>");
                }
            });   
        }
        
        function createDetailDataTable(data) {
            $('#details').html(format(data))};

        
          function format(d){
              // `d` is the original data object for the row
              return "<div><a data-toggle='modal' data-target='#myMaintenanceModal' class='btn btn-md btn-pink no-border btn-round pull-right' id='btnmodal'><i class='ace-icon fa fa-check icon-animated-bell bigger-125'></i>Make Maintenance Card Request<i class='ace-icon fa fa-arrow-right icon-on-right icon-animated-vertical'></i></a></div><br><div class='table-header'>Customer's Details</div><table class='table table-striped table-bordered table-hover'>" +
                  '<tr>' +
                      '<td width="35%"><strong>Customers App Date: </strong></td>' +
                      '<td>' + moment(new Date(d.customerAppDate)).format("YYYY-MM-DD") + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Request Date: </strong></td>' +
                      '<td>' + moment(new Date(d.requestDate)).format("YYYY-MM-DD") + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Account Number: </strong></td>' +
                      '<td>' + d.accountNumber + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Client Code: </strong></td>' +
                      '<td>' + d.clientCode + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Branch Code: </strong></td>' +
                      '<td>' + d.branchCode + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Currency: </strong></td>' +
                      '<td>' + d.currency + '</td>' +
                  '</tr>' +
                 '<tr>' +
                  '<td width="15%"><strong>Account Operation: </strong></td>' +
                      '<td>' + d.accountOperation + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Account Type: </strong></td>' +
                      '<td>' + d.accountType + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Full Name: </strong></td>' +
                      '<td>' + d.fName +' ' + d.lName + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Gender: </strong></td>' +
                      '<td>' + d.gender  + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Marital Status: </strong></td>' +
                      '<td>' + d.maritalStatus  + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Contact Address : </strong></td>' +
                      '<td>' +  d.contactAddress + '</td>' +
                  '</tr></div>' +
                  '<tr>' +
                      '<td width="15%"><strong>Email: </strong></td>' +
                      '<td>' + d.emailAddress + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Mobile Number: </strong></td>' +
                      '<td><i class="fa fa-mobile light-red bigger-110"> </i> ' + d.mobileNumber + '</td>' +
                  '</tr>' +
                  '<tr>' +
                      '<td width="15%"><strong>Telephone Number: </strong></td>' +
                      '<td><i class="fa fa-phone light-orange bigger-110"> </i> ' + d.phoneNumber + '</td>' +
                  '</tr>' +
                 '<tr>' +
                 '<td width="15%"><strong>Card Req. Originating Branch: </strong></td>' +
                 '<td>' + d.cardReqOriginatingBranch + '</td>' +
                 '</tr>' +
                 '<tr>' +
                     '<td width="15%"><strong>Card Status: </strong></td>' +
                     '<td>' + d.cardStatus + '</td>' +
                 '</tr>' +
                 '<tr>' +
                     '<td width="15%"><strong>Status Updated Date: </strong></td>' +
                     '<td>' +  moment(new Date(d.statusUpdatedDate)).format("YYYY-MM-DD")   + '</td>' +
                 '</tr>' +
                 '<tr>' +
                     '<td width="15%"><strong>Card Remarks: </strong></td>' +
                     '<td>' + d.requestRemark + '</td>' +
                 '</tr>' +
                 '<tr>' +
                     '<td width="15%"><strong>Other Remarks: </strong></td>' +
                     '<td>' + d.otherRemarks  + '</td>' +
                 '</tr>' +
             
              '</table>';  
         }
    </script>
        

<script>

</script>

<script>
    $(function() {
        var start = moment().subtract(29, 'days');
        var end = moment();
        
          $('.dateRange').daterangepicker({
            startDate: start,
            endDate: end,
            opens: 'left',
            autoclose: true,
            todayHighlight: true,
            ranges: {
               'Today': [moment(), moment()],
               'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
               'Last 7 Days': [moment().subtract(6, 'days'), moment()],
               'Last 30 Days': [moment().subtract(29, 'days'), moment()],
               'This Month': [moment().startOf('month'), moment().endOf('month')],
               'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            },
           locale: {
                 format: 'YYYY-MM-DD'
                 }
          }, function(start, end, label) {
        	  if(!$('#idBranchNameSearch').val()){
        		  ajaxGetMaLogByDateBetween(start, end);

				}else{
					ajaxGetMaLogByDateBtnBranch(start, end, $('#idBranchNameSearch').val());
				}
            
          });
          
        });
</script>

<script type='text/javascript'>
    $(function() {
        $(".date-pickerForm").datepicker({
            format : "yyyy-mm-dd",
            autoclose : true,
            todayBtn : "linked",
            todayHighlight : true
        }).datepicker('update', new Date());
    });
</script>

<script>
    $('.modal-dialog').draggable({
        "handle" : ".modal-header"
    });

    autosize($('textarea[class*=autosize]'));

    $('textarea.limited').inputlimiter({
        remText : '%n character%s remaining...',
        limitText : 'max allowed : %n.'
    });
    $('#idPresentCardNumber').mask('99999', {
		autoclear : false
	});
    $('.select2').css('width', '100%').select2({
				});
</script>

<script>
    $(document).ready(function() {
    	ajaxGetMaintenanceLog();
    });
    
    function ajaxGetMaintenanceLog(){
        const url = '/getalllog';
        $.getJSON(url, function (data) {
            createMaintenanceLogTable(data);
            
        });
    }
    
	$("#idBranchNameSearch").change(function() {
		let branchNameVal = $("#idBranchNameSearch :selected").val();	
		ajaxgetMLogByBranch(branchNameVal);
    });
	
	/* search by branchName */
		function ajaxgetMLogByBranch(branchName){
			const url = '/getLogs/branchname/'+branchName;
			$.getJSON(url, function (data) {
				createMaintenanceLogTable(data);
			});
		}
    
	function ajaxGetMaLogByDateBetween(start, end){
			let startDate=start.format('YYYY-MM-DD');
			let endDate=end.format('YYYY-MM-DD');
			const url = '/getLogs/date/'+startDate+'/'+endDate;
			$.getJSON(url, function (data) {
			 createMaintenanceLogTable(data);
			});
		}
	
	/*  card Maintenance log with branch */
	function ajaxGetMaLogByDateBtnBranch(start, end, branchName){
			let startDate=start.format('YYYY-MM-DD');
			let endDate=end.format('YYYY-MM-DD');
			const url = '/getLogs/'+startDate+'/'+endDate +'/' + branchName;
			$.getJSON(url, function (data) {
			 createMaintenanceLogTable(data);
			});
		}
	
	
            function createMaintenanceLogTable(data){
	         var table = $('#maintenanceLog-table').DataTable({
	        	 "order": [ 1, "desc" ],
	        	 destroy: true,
	             "data": data,
	             select:"single",
	             "columns": [
	                 {
	                     "className": 'details-control',
	                     "orderable": false,
	                     "data": null,
	                     "defaultContent": '',
	                     "render": function () {
	                         return '<i class="ace-icon fa fa-angle-double-down fa-2x" title="Show details" aria-hidden="true"></i>';
	                     },
	                     width:"15px"
	                 },
	                { "data": "customerAppDate",
	                	 "render" : function(data, type, row, meta) {
								if (data === null) return "";
								var thisDate = moment(new Date(data)).format("YYYY-MM-DD");
								return thisDate
							}
	                 },
	                 { "data": "accountNumber",
	 	                	"render": function(data,type,row,meta) { // render event defines the markup of the cell text 
	 	                       var a = '<a href="/getalllog/detailpage/' + row["id"]+ '">' + row.accountNumber +'</a>';
	 	                       return a;}
	 	                 },
	                 { "data": "cardNumber" },
	                 { "data": "oldCardNumber" },
	                 { "data": "maintenanceRequestFor" },
	                 { "data": "maintenanceRequestDate",
	                	 "render" : function(data, type, row, meta) {
								if (data === null) return "";
								var thisDate = moment(new Date(data)).format("YYYY-MM-DD");
								return thisDate
							}
	                 },
	                 { "data": "branchName"
	                 },
	                 { "data": "maintenanceRemarks" },
	                 { "data": "mlLodgedBy" },
	                 { "data": "mlLodgedModifiedBy" },
	                 {
							"data" : null,
							"className" : 'center',
							"orderable" : false,
							"render" : function(data, type,
									row, meta) { // render event defines the markup of the cell text 
								var a = '<div class="btn-group"><a class="btn btn-xs no-border btn-round btn-success" title="Click to view details." href="/getalllog/detailpage/' + row["id"]+ '"><i class="ace-icon fa fa-search-plus bigger-160" aria-hidden="true"></i></a></div>';
								return a;
							}
						},
						{
							"data" : null,
							"className" : 'center',
							"orderable" : false,
							"render" : function(data, type,
									row, meta) { // render event defines the markup of the cell text 
								var a = '<div class="btn-group"><a class="btn btn-xs btn-danger mLog_delete" title="Delete details.">&nbsp;<i class="ace-icon fa fa-trash-o bigger-160" aria-hidden="true"></i></a></div>';
								return a;
							}
						} ],
	             dom: 'Blfrtip',
	             buttons: [
	            	 {
							"extend": "copy",
							"text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
							"className": "btn btn-white btn-primary btn-bold"
						  },
						  {
							"extend": "csv",
							"text": "<i class='fa fa-file-excel-o bigger-110 blue'></i> <span class='hidden'>Export to CSV</span>",
							"className": "btn btn-white btn-primary btn-bold"
						  },
						  {
							"extend": "excel",
							"text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
							"className": "btn btn-white btn-primary btn-bold",
							"exportOptions": { modifier: { page: 'all'} }
						  },
						  {
							"extend": "pdf",
							"text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
							"className": "btn btn-white btn-primary btn-bold",
							"exportOptions": { modifier: { page: 'all'} }
						  },
						  {
							"extend": "print",
							"text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
							"className": "btn btn-white btn-primary btn-bold",							
							autoPrint: false,
							orientation:'landscape',
							title: 'Maintenance Log List'
						  }		  
	             ]
	            
	         });
	        
	         // Add event listener for opening and closing details
	         $('#maintenanceLog-table tbody').on('click', 'td.details-control', function () {
	             var tr = $(this).closest('tr');
	             var tdi = tr.find("i.fa");
	             var row = table.row(tr);

	             if (row.child.isShown()) {
	                 // This row is already open - close it
	                 row.child.hide();
	                 tr.removeClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-up fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-down fa-2x');
	             }
	             else {
	                 // Open this row
	                 row.child(format(row.data())).show();
	                 tr.addClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-down fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-up fa-2x');
	             }
	         });

	         table.on("user-select", function (e, dt, type, cell, originalEvent) {
	             if ($(cell.node()).hasClass("details-control")) {
	                 e.preventDefault();
	             }
	         });
	         
	  	    function format(d){
	 	         // `d` is the original data object for the row
	 	         return '<table class="table table-striped table-bordered table-hover">' +
		 	        '<tr>' +
			             '<td width="25%"><strong>'+ "Customer's"+" App Date:"+ '</strong></td>' +
			             '<td>' +  moment(new Date(d.customerAppDate)).format("YYYY-MM-DD") + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Maintenance Request Date: </strong></td>' +
			             '<td>' +  moment(new Date(d.maintenanceRequestDate)).format("YYYY-MM-DD") + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Old Card Number: </strong></td>' +
			             '<td>' +  d.oldCardNumber + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Present Card Number	: </strong></td>' +
			             '<td>' +  d.cardNumber + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Account Number: </strong></td>' +
			             '<td>' +  d.accountNumber + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Maintenance Request For: </strong></td>' +
			             '<td>' + d.maintenanceRequestFor + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Branch Name: </strong></td>' +
			             '<td>' +  d.branchName + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Remarks (Maintenance): </strong></td>' +
			             '<td>' +  d.maintenanceRemarks + '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Logged By: </strong></td>' +
			             '<td>' +  d.mlLodgedBy+ '</td>' +
		         	'</tr>' +
		 	        '<tr>' +
			             '<td width="25%"><strong>Logged Modified By	: </strong></td>' +
			             '<td>' + d.mlLodgedModifiedBy + '</td>' +
		         	'</tr>' +
			     
	 	         '</table>';  
	 	    } 
	  	    
		  	  // Delete record - In Transit
	  	    $('#maintenanceLog-table').on('click', 'a.mLog_delete', function (e) {
	  	        e.preventDefault();
	  	      var row_val = table.row($(this).closest('tr'));
	          var data_val= row_val.data();
	  	       deleteMaintenanceLog(data_val.id);
	  	
	  	    } );		         
		}
            
	  	    
    		function deleteMaintenanceLog(control) {
    	        var dialog = bootbox.dialog({
    	        	title: 'Delete Maintenance Log Data!!!',
    	        	message: '<p>Are you sure you want to delete recorded maintenance log data?</p>',
    	            size: 'md',
    	            onEscape: true,
    	            backdrop: true,
    	            buttons: {
    	                cancel: {
    	                	label: '<i class="fa fa-times"></i> Cancel',
    	                    className: 'btn-danger pull-right margin-left-10px',
    	                },
    	                ok: {
    	                	label: '<i class="fa fa-check"></i> Confirm',
    	                    className: 'btn-info',
    	                    callback: function(result){
    	                    	if(result){
    	                    		$.ajax({
    	                    	        type: 'DELETE',
    	                    	        url:  '/updatemaintenancelog/delete/' + control,
    	                    	        success: function(result) {
    	                    	        	$('#showMessage').append("<div class='alert alert-danger'><button type='button' class='close' data-dismiss='alert'><i class='ace-icon fa fa-times'></i></button><br>"
    	                    	        			+ result.message+  ': '+ result.data+"</div>");
    	                    	        	alert(result.message
    	                    	                + ': '+ result.data);
    	                    	        	window.location.href = "/cardmaintenancelog";
    	                    	        },
    	                    	        error: function(jqXHR, textStatus, errorThrown) {
    	                    	            alert(jqXHR.status + ' ' + jqXHR.responseText);
    	                    	        }
    	                    	    });
    	                    	}
    	                    }
    	                }
    	            },
    	        });
    		}       
    

</script>



	</th:block>
</body>
</html>
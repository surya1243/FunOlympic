<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{layouts/default}">

<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta charset="utf-8" />
	<title>Password Change Page</title>
</head>

<body>
	<div layout:fragment="content">
		<div class="breadcrumbs ace-save-state" id="breadcrumbs">
			<ul class="breadcrumb">
				<li>
					<i class="ace-icon fa fa-home home-icon"></i>
					<a href="#">Home</a>
				</li>
				<li class="active">Change Password</li>
			</ul><!-- /.breadcrumb -->
		</div>
		<div class="page-content">
			<div class="page-header">
				<h1>
					<i class="ace-icon fa fa-key"></i> Change Password
				</h1>
			</div><!-- /.page-header -->
			<div th:if="${message}">
				<h2 class="alert alert-danger" th:text="${message}"></h2>
			</div>
			<div class="col-xs-12">
				<div class="space-12"></div>
				<form th:action="@{/changePassword}" th:object="${appUser}" method="POST" class="form-horizontal"
					data-toggle="validator" role="form">
					<input type="hidden" name="id" th:value="${user.id}" />
					<div class="form-group">
						<label class="col-sm-4 control-label no-padding-right" for="inputPassword"> New Password:
						</label>
						<div class="col-sm-3">
							<div class="input-group">
								<input type="password" data-minlength="5" class="form-control" id="inputPassword"
									data-error="Must enter minimum of 5 characters" placeholder="Password" required>
								<span class="input-group-addon">
									<i class="fa fa-key"></i>
								</span>
							</div>
							<div class="help-block with-errors"></div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label no-padding-right" for="inputPasswordConfirm"> Confirm
							Password: </label>
						<div class="col-sm-3">
							<div class="input-group">
								<input type="password" name="password" class="form-control" id="inputPasswordConfirm"
									data-match="#inputPassword" data-match-error="Whoops, password don't match"
									placeholder="Confirm" required>
								<span class="input-group-addon">
									<i class="fa fa-key"></i>
								</span>
							</div>
							<div class="help-block with-errors"></div>
						</div>
					</div>
					<div class="clearfix form-actions col-sm-offset-3 col-sm-4">
						<button type="reset" class="width-35 pull-left btn btn-sm">
							<i class="ace-icon fa fa-refresh"></i> <span class="bigger-110">Reset</span>
						</button>
						<button type="submit" class="width-60 pull-right btn btn-sm btn-success">
							<span class="bigger-110">Register</span> <i
								class="ace-icon fa fa-arrow-right icon-on-right"></i>
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</body>
<th:block layout:fragment="scripts">
		<script>
		$(document).ready(function () {
			document.getElementById("sportsListContainer").style.display = "none";
			ajaxGetSports();
		});

		function ajaxGetSports() {
			let checkboxContainer = $('#checkbox-container');
			const itemsPerPage = 5; // Number of checkboxes per page
			let currentPage = 1; // Current page number

			if (!checkboxContainer.length) {
				console.error('Checkbox container element not found');
				return;
			}

			checkboxContainer.empty();

			const url = '/getsports';

			$.getJSON(url, function (data) {
				if (!data || data.length === 0) {
					console.warn('No data received or data is empty');
					return;
				}

				let allItems = []; // Array to store all checkbox items
				let selectedSports = $('#selectedSports').val().split(','); // Get selected sports from hidden input

				$.each(data, function (key, entry) {
					let isChecked = selectedSports.includes(entry.sportsName); // Check if sport is selected
					let checkbox = $('<input />', {type: 'checkbox', name: 'selectedSports', id: 'sports_' + key, value: entry.sportsName, checked: isChecked});
					let label = $("<label/>", {'for': 'sports_' + key, text: entry.sportsName});

					// Wrap checkbox and label in a div for easier manipulation
					let checkboxWrapper = $('<div class="checkbox-item"></div>');
					checkboxWrapper.append(checkbox).append(label);
					allItems.push(checkboxWrapper); // Add to all items array
				});

				// Function to display checkboxes for a specific page
				function displayCheckboxes(page) {
					checkboxContainer.empty();
					let startIndex = (page - 1) * itemsPerPage;
					let endIndex = startIndex + itemsPerPage;
					for (let i = startIndex; i < endIndex && i < allItems.length; i++) {
						checkboxContainer.append(allItems[i]);
					}
				}

				// Show initial page of checkboxes
				displayCheckboxes(currentPage);

				// Function to update pagination links based on current page
				function updatePaginationLinks() {
					paginationContainer.empty(); // Clear previous pagination links

					let totalPages = Math.ceil(allItems.length / itemsPerPage);

					let prevPageLink = $('<span/>', {
						class: 'pagination-link',
						text: '<<Prev',
						click: function (e) {
							e.preventDefault(); // Prevent default link behavior
							if (currentPage > 1) {
								currentPage--;
								displayCheckboxes(currentPage);
								updatePaginationLinks();
							}
						}
					});

					if (currentPage > 1) {
						paginationContainer.append(prevPageLink);
					}

					for (let i = 1; i <= totalPages; i++) {
						let pageLink = $('<span/>', {
							class: 'pagination-link',
							text: i,
							click: function (e) {
								e.preventDefault(); // Prevent default link behavior
								currentPage = i;
								displayCheckboxes(currentPage);
								updatePaginationLinks();
							}
						});

						if (i === currentPage) {
							pageLink.addClass('current-page'); // Highlight current page in green
						}

						paginationContainer.append(pageLink);
					}

					let nextPageLink = $('<span/>', {
						class: 'pagination-link',
						text: 'Next>>',
						click: function (e) {
							e.preventDefault(); // Prevent default link behavior
							if (currentPage < totalPages) {
								currentPage++;
								displayCheckboxes(currentPage);
								updatePaginationLinks();
							}
						}
					});

					if (currentPage < totalPages) {
						paginationContainer.append(nextPageLink);
					}
				}

				// Create pagination container
				let paginationContainer = $('<div class="pagination-container"></div>');

				// Append pagination container after checkbox container
				checkboxContainer.after(paginationContainer);

				// Initialize pagination links
				updatePaginationLinks();

			}).fail(function (jqxhr, textStatus, error) {
				console.error("Request Failed: " + textStatus + ", " + error);
			});
		}

	</script>
</th:block>

</html>
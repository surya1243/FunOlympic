<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layouts/default">
<head>
<meta charset="ISO-8859-1" />
<title>Locker Log Records</title>


<th:block layout:fragment="styles">
<link rel="stylesheet" href="../static/css/daterangepicker.min.css" th:href="@{/css/daterangepicker.min.css}" />
    <style type="text/css">
		  td.details-control {
		            text-align:center;
		            color:forestgreen;
		    cursor: pointer;
		}
		tr.shown td.details-control {
		    text-align:center; 
		    color:red;
		}
    </style>
  </th:block>  
 </head>
<body>

	<div layout:fragment="content">
		<div class="breadcrumbs ace-save-state" id="breadcrumbs">
			<ul class="breadcrumb">
				<li><i class="ace-icon fa fa-home home-icon"></i> <a href="/dashboard">Home</a>
				</li>

				<li>Locker In/Out Log</li>
				<li class="active">Locker Log Records</li>
			</ul>
			<!-- /.breadcrumb -->
		</div>

		<div class="page-content">
			<div class="row">
				<div class="col-xs-12">
					<!-- PAGE CONTENT BEGINS -->
					<div th:if="${message}">
						<h2 class="alert alert-danger" th:text="${message}"/>
					</div>
					<div th:if="${successMessage}">
						<div class="alert alert-success">
							<button type="button" class="close" data-dismiss="alert">
								<i class="ace-icon fa fa-times"></i>
							</button>
							<strong th:text="${successMessage}">Success!</strong> <br />
						</div>
					</div>
				</div>				
			</div>	
			<div class="row">
				<div class="col-xs-12 col-sm-12">
					<div class="search-area well well-sm">
						<div class="search-filter-header bg-primary">
							<h5 class="smaller no-margin-bottom">
								<i class="ace-icon fa fa-sliders light-green bigger-130"></i>&nbsp; Refine your Search
							</h5>
						</div>
							<div class="space-10"></div>								
						<fieldset class="form-inline">
							<div class="input-group col-sm-3"> 
								<select class="form-control" id="branchName-dropdown" name="branchName" required></select>                                               
                                 </div>
                             <div class="input-group col-sm-3">
								<select class="chosen-select form-control"
									id="idLockerStatus" name="lockerStatus"
									data-placeholder="Choose a Locker status..."
									data-error="Please select Locker status field." required>
									<option value=""></option>
									<option value="Active">Active</option>
									<option value="Inactive">Inactive</option>
									<option value="Payment Due">Payment Due</option>
									<option value="Surrendered">Surrendered</option>
									<option value="Closed">Closed</option>
									<option value="Blocked">Blocked</option>
									<option value="Stopped">Stopped</option>
								</select>                                         
                             </div>
                             
														                             
                             <div class="inline pull-right">
	                              <label for="idDateRange"> Checked In Date Range Picker: </label> 
		                        <div class="input-group">
									<span class="input-group-addon"><i class="fa fa-calendar bigger-110"></i></span> 
									<input class="form-control" type="text" name="date-range-picker"
												data-date-format="yyyy-mm-dd" id="idDateRange" />
								</div>
							</div> 
							                         
						</fieldset>
						<div class="space-4"></div>	
					</div>
				</div>
			</div>					
			<div class="row">
				<div class="col-xs-12 table-responsive">
					<div>					
						<div class="table-header">Locker In/Out Log Report
						</div>
						 <table width="100%" id="dynamic-table" class="table table-striped table-bordered table-hover">
					        <thead>
					            <tr>
					                <th width="5%" class="detail-col"></th>
									<th width="8%"> Locker ID </th>
									<th width="12%"> Checked In Date</th>
									<th> In Time </th>
									<th> Out Time </th>
									<th width="15%"> Locker Holder's Name </th>
									<th width="8%"> Status </th>
									<th data-class="hidden"> Authorized Person </th>
									<th width="15%"> Used By</th>									
									<th data-class="hidden"> (A-Panel)</th>									
									<th data-class="hidden"> (B-Panel)</th>									
									<th width="15%"> Branch</th>									
									<th data-class="hidden"> Remarks</th>	
									<th width="8%">Action</th>	
					            </tr>
					        </thead>
					    </table>   
					</div>
					<!-- PAGE CONTENT ENDS -->
				</div>
			</div>
		</div>
	</div>

	<th:block layout:fragment="scripts">
 		<script>
 		$(function() {
			
 			var start = moment().subtract(29, 'days');
 		    var end = moment();
 		    
 			  $('#idDateRange').daterangepicker({
 				startDate: start,
 		        endDate: end,
 			    opens: 'left',
 			    autoclose: true,
 				todayHighlight: true,
 				ranges: {
 		           'Today': [moment(), moment()],
 		           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
 		           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
 		           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
 		           'This Month': [moment().startOf('month'), moment().endOf('month')],
 		           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
 		        },
				locale : {
					format : 'YYYY-MM-DD'
				}
 			  }, function(start, end, label) {
 				ajaxGetLockerLogByDateBetween(start, end);
 			  });
 			  
 			});
 		</script>
 		
 		
    <script>
		if (!ace.vars['touch']) {
			$('.chosen-select').chosen({
				allow_single_deselect : true
			});
			//resize the chosen on window resize
			$(window).off('resize.chosen').on('resize.chosen',
					function() {
						$('.chosen-select').each(function() {
							var $this = $(this);
							$this.next().css({
								'width' : $this.parent().width()
							});
						})
					}).trigger('resize.chosen');
			//resize chosen on sidebar collapse/expand
			$(document).on('settings.ace.chosen',
					function(e, event_name, event_val) {
						if (event_name != 'sidebar_collapsed')
							return;
						$('.chosen-select').each(function() {
							var $this = $(this);
							$this.next().css({minWidth: '380px'});
						})
					});
		}
	</script>

    
<script th:inline="javascript">
     $(document).ready(function () {
    	 ajaxGetAllLockerLog();
     });
    	 
 		$("#branchName-dropdown").change(function() {
			 if(!$('#idLockerStatus').val()){
					ajaxgetLcokerLogByBranchName();
			 }else{
				 ajaxgetLockerLogByTypeOfService();
			 }
			
	    });
 		
 		$("#idLockerStatus").change(function() {
			if(!$('#branchName-dropdown').val()){
				ajaxgetLockerLogByStatus();
			}else{
				ajaxgetLockerLogByTypeOfService();
			 }
			
		});

		function ajaxGetAllLockerLog(){
			 const url = '/getlockerLoglist/all';
			 $.getJSON(url, function (data) {
				 createDataTable(data);
			 });
		 }		
		
		function ajaxgetLockerLogByStatus(){
			 let lockerStatusVal = $('#idLockerStatus').val();
 			const url = '/getlockerLoglist/status/'+lockerStatusVal;
 			$.getJSON(url, function (data) {
 				createDataTable(data);
 			});
 		}
 		

 		
 		function ajaxgetLcokerLogByBranchName(){
 			let branchName = $('#branchName-dropdown').val();
 			const url = '/getlockerLoglist/branchname/'+branchName;
 			$.getJSON(url, function (data) {
 				createDataTable(data);
 			});
 		}
 		
 		function ajaxgetLockerLogByTypeOfService(){
			 let lockerStatusVal = $('#idLockerStatus').val();
			 let branchVal = $('#branchName-dropdown').val();
 			const url = '/getlockerLoglist/status/'+lockerStatusVal+'/'+branchVal;
 			$.getJSON(url, function (data) {
 				createDataTable(data);
 			});
 		}
 		
 		
		function ajaxGetLockerLogByDateBetween(start, end){
 			let startDate=start.format('YYYY-MM-DD');
 			let endDate=end.format('YYYY-MM-DD');
 			const url = '/getlockerLoglist/'+startDate+'/'+endDate;
 			$.getJSON(url, function (data) {
 				createDataTable(data);
 			});
 		}
 		
 		function createDataTable(data){
	         var table = $('#dynamic-table').DataTable({
	        	 "order": [ 2, "desc" ],
	        	 destroy: true,
	             "data": data,
	             select:"single",
	             "columns": [
 	                 {
 	                     "className": 'details-control',
 	                     "orderable": false,
 	                     "data": null,
 	                     "defaultContent": '',
 	                     "render": function () {
 	                         return '<i class="ace-icon fa fa-angle-double-down fa-2x" title="Show details" aria-hidden="true"></i>';
 	                     },
 	                     width:"15px"
						},
						{ "data": "lockerId" },
 	                 { "data": "checkednDate",
 	                	 "render" : function(data, type, row, meta) {
 								if (data === null) return "";
 								var thisDate = moment(new Date(data)).format("YYYY-MM-DD");
 								return thisDate
 							}
 	                 },
 	                 { "data": "checkedInTime"
 	                 },
 	                 { "data": "checkedOutTime" },
 	                 { "data": "lockerHolderName" },
 	                 { "data": "lockerStatus" },
 	                 { "data": "authorizedPerson" },
 	                 { "data": "lockerUsedBy" },
 	                 { "data": "custodianA" },
 	                 { "data": "custodianB" },
 	                 { "data": "lockerExistBranch" },
 	                 { "data": "remark" },
 	                 { "data": null,
	                	 "className": 'center',
	                	 "orderable": false,
	 	                	"render": function(data,type,row,meta) { // render event defines the markup of the cell text 
	 	                		 var a = '<div class="btn-group"><a class="btn btn-xs no-border btn-round btn-success" title="Click to view details." href="/lockerlog/detailpage/' + row["id"]+ '">View &nbsp;</a></div>';
		  	                       return a;}
	 	                 }
 	             ],             
 	             dom: 'Blfrtip',
 	             buttons: [
 	            	 {
 							"extend": "copy",
 							"text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
 							"className": "btn btn-white btn-primary btn-bold"
 						  },
 						  {
 							"extend": "csv",
 							"text": "<i class='fa fa-file-excel-o bigger-110 blue'></i> <span class='hidden'>Export to CSV</span>",
 							"className": "btn btn-white btn-primary btn-bold"
 						  },
 						  {
 							"extend": "excel",
 							"text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
 							"className": "btn btn-white btn-primary btn-bold",
 							"exportOptions": { modifier: { page: 'all'} }
 						  },
 						  {
 							"extend": "pdf",
 							"text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
 							"className": "btn btn-white btn-primary btn-bold",
 							"exportOptions": { modifier: { page: 'all'} }
 						  },
 						  {
 							"extend": "print",
 							"text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
 							"className": "btn btn-white btn-primary btn-bold",							
 							autoPrint: true,
 							orientation:'landscape',
 							title: 'Locker In/Out Log'
 						  }		  
 	             ]
	            
	         });
	        
	         // Add event listener for opening and closing details
	         $('#dynamic-table tbody').on('click', 'td.details-control', function () {
	             var tr = $(this).closest('tr');
	             var tdi = tr.find("i.fa");
	             var row = table.row(tr);

	             if (row.child.isShown()) {
	                 // This row is already open - close it
	                 row.child.hide();
	                 tr.removeClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-up fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-down fa-2x');
	             }
	             else {
	                 // Open this row
	                 row.child(format(row.data())).show();
	                 tr.addClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-down fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-up fa-2x');
	             }
	         });

	         table.on("user-select", function (e, dt, type, cell, originalEvent) {
	             if ($(cell.node()).hasClass("details-control")) {
	                 e.preventDefault();
	             }
	         });
	         
	  	    function format(d){
	 	         // `d` is the original data object for the row
	 	         return '<table class="table table-striped table-bordered table-hover">' +
	 	             '<tr>' +
	 	                 '<td width="20%"><strong>Locker ID: </strong></td>' +
	 	                 '<td>' + d.lockerId + '</td>' +
	 	             '</tr>' +
	 	             '<tr>' +
						  '<td width="20%"><strong>Checked In Date: </strong></td>' +
						  '<td>' + moment(new Date(d.checkednDate)).format("YYYY-MM-DD") + '</td>' +
	 	             '</tr>' +
	 	             '<tr>' +
	 		             '<td width="20%"><strong>Checked In Time: </strong></td>' +
	 		             '<td>' + d.checkedInTime + '</td>' +
	 		         '</tr>' +
	 		         '<tr>' +
	 			         '<td width="20%"><strong>Checked Out Time: </strong></td>' +
	 			         '<td>' + d.checkedOutTime + '</td>' +
	 			     '</tr>' +
	 			     '<tr>' +
	 			         '<td width="20%"><strong>'+"Locker Holder's Name:"+' </strong></td>' +
	 			         '<td>' + d.lockerHolderName + '</td>' +
	 			     '</tr>' +
	 			     '<tr>' +
	 				     '<td width="20%"><strong>Locker Status: </strong></td>' +
	 				     '<td>' + d.lockerStatus + '</td>' +
	 				 '</tr>' +
	 			     '<tr>' +
	 				     '<td width="20%"><strong>Authorized Person (To operate locker) : </strong></td>' +
	 				     '<td>' + d.authorizedPerson + '</td>' +
	 				 '</tr>' +
	 			     '<tr>' +
	 				     '<td width="20%"><strong>'+"Locker Opened/Used By:"+'</strong></td>' +
	 				     '<td>' + d.lockerUsedBy + '</td>' +
	 				 '</tr>' +
	 			     '<tr>' +
	 				     '<td width="20%"><strong>'+"Custodian's Name (A-Panel):"+' </strong></td>' +
	 				     '<td>' + d.custodianA + '</td>' +
	 				 '</tr>' +
	 			     '<tr>' +
	 				     '<td width="20%"><strong>'+"Custodian's Name (B-Panel):"+' </strong></td>' +
	 				     '<td>' + d.custodianB + '</td>' +
	 				 '</tr>' +
	 			     '<tr>' +
	 				     '<td width="20%"><strong>Locker Exists Branch : </strong></td>' +
	 				     '<td>' + d.lockerExistBranch + '</td>' +
	 				 '</tr>' +
	 			     '<tr>' +
	 				     '<td width="20%"><strong>Remarks: </strong></td>' +
	 				     '<td>' + d.remark + '</td>' +
	 				 '</tr>' +
	 	         '</table>';  
	 	    }
		}
    
     
		
</script>
					
	</th:block>

</body>
</html>
<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.w3.org/1999/xhtml"
	  layout:decorate="~{layouts/default}">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title> Edit Card Delivery</title>
    <th:block layout:fragment="styles">
        
    </th:block>
</head>
<body>
    <div layout:fragment="content" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
		<div class="breadcrumbs ace-save-state" id="breadcrumbs">
			<ul class="breadcrumb">
				<li>
					<i class="ace-icon fa fa-home home-icon"></i>
					<a href="#">Home</a>
				</li>
				<li>
					<a href="/carddelivery">Card Delivery Record</a>
				</li>
				<li class="active">Edit Card Delivery Form</li>
			</ul><!-- /.breadcrumb -->						
		</div> 
		
		<div class="page-content">
			<div class="row">
				<div class="col-xs-12">
					<!-- PAGE CONTENT BEGINS -->
					<div th:if="${message}">
						<h2 class="alert alert-danger" th:text="${message}" />
					</div>
					<div th:if="${successMessage}">
						<div class="alert alert-success">
							<button type="button" class="close" data-dismiss="alert">
								<i class="ace-icon fa fa-times"></i>
							</button>
							<strong th:text="${successMessage}">Success!</strong> <br />
						</div>
					</div>
				</div>
			</div>
			<div class="page-header">
				<h1>
					<i class="ace-icon fa fa-credit-card"></i> Update Card Delivery Record Form
				</h1>
			</div>
			<!-- /.page-header -->
			<div class="row">
				<div class="col-xs-12">
							<form method="POST" th:object="${cardDelivery}"
										modelAttribute="cardDelivery" autocomplete="off"
										th:action="@{/updatecarddelivery}" class="form-horizontal"
										data-toggle="validator" role="form">
										<div class="hide">
											<input type="text" name="id" th:value="${cardDeliveryValById?.id}"/>
											<input type="text" name="lodgedBy" th:value="${cardDeliveryValById?.lodgedBy}"/>
											<input type="text" name="deliveryPhase" th:value="${cardDeliveryValById?.deliveryPhase}"/>
										</div>
										
										<div class="col-sm-6 form-actions">
										<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idReferenceNumber"> Reference Number <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
												<input id="idReferenceNumber" type="text" name="referenceNumber"
														class="col-xs-12 col-sm-12" placeholder="Enter Reference Number"
														th:value="${cardDeliveryValById?.referenceNumber}"  required/>
													<div class="help-block with-errors"></div>
												</div>
										</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idBranchnameVal"> Destination Branch <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<select class="form-control select2" id="idBranchnameVal" name="destinationBranch" data-placeholder="Choose Branch..." data-error="Select Bank branch" required>
														<option th:each="branchList : ${branchValue}"
					                           										 th:value="${branchList.branchName}"
					                          										 th:text="${branchList.branchName}">Branch</option>
														</select>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idDispatchedDate"> Dispatched Date <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<input id="idDispatchedDate" type="text"
														name="dispatchedDate" th:value="${{cardDeliveryValById?.dispatchedDate}}" 
														class="col-xs-12 col-sm-12 date-picker1"
														data-date-format="yyyy-mm-dd"
														placeholder="Select Dispatched Date" required />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idDispatchedMedium"> Dispatched Medium <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<select class="select2 col-xs-12 col-sm-12"
														id="idDispatchedMedium" name="dispatchedMedium"
														data-placeholder="Choose a Dispatched Medium..." required>
														<option value=""></option>
														<option value="Courrier">Courrier</option>
														<option value="POFIL Staff">POFIL Staff</option>
														<option value="Others">Others</option>
													</select>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idCarrierStaff"> Details of Courrier/Staff <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<textarea name="detailsOfCourrierStaff" th:value="${cardDeliveryValById?.detailsOfCourrierStaff}" 
													th:text="${cardDeliveryValById?.detailsOfCourrierStaff}"
														placeholder="Description" required id="idCarrierStaff"
														class="col-xs-12 col-sm-12"></textarea>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idNumberOfCardDispatched"> Number of Card
													Dispatched<span class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<input id="idNumberOfCardDispatched" type="text"
														name="numberOfCardDispatched" class="col-xs-12 col-sm-12"
														pattern="^\d+$" th:value="${cardDeliveryValById?.numberOfCardDispatched}" 
														onblur="this.parentNode.parentNode.style.backgroundColor=/^\d+$/.test(this.value)?'inherit':'#f28c0e14'"
														placeholder="Enter Number of Card Dispatched" required />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idNumberOfPinDispatched"> Number of Pin
													Dispatched<span class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<input id="idNumberOfPinDispatched" type="text"
														name="numberOfPinDispatched" class="col-xs-12 col-sm-12"
														pattern="^\d+$" th:value="${cardDeliveryValById?.numberOfPinDispatched}" 
														onblur="this.parentNode.parentNode.style.backgroundColor=/^\d+$/.test(this.value)?'inherit':'#f28c0e14'"
														placeholder="Enter Number of Pin Dispatched" required />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idDeliveryStatus"> Delivery Status <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<select class="select2 col-xs-12 col-sm-12"
														id="idDeliveryStatus" name="deliveryStatus"
														data-placeholder="Choose a Dispatched Medium..." required>
														<option value=""></option>
														<option value="In_Transit">In-Transit</option>
														<option value="Delivered">Delivered</option>
													</select>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											
											
											<div class="form-group hide">
												<label class="col-sm-4 control-label no-padding-right"
													for="idLodgedModifiedBy"> Lodged Modified By: </label>
												<div class="col-sm-8">
													<input id="idLodgedModifiedBy" type="text" name="lodgedModifiedBy"
														class="col-xs-12 col-sm-12"
														th:value="${currentUser.email}" required readonly />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="clearfix">
												<button type="submit" id="btnUploadFile"
													class="width-65 pull-right btn btn-sm btn-success">
													<span class="bigger-110"> Submit </span> <i
														class="ace-icon fa fa-arrow-right icon-on-right"></i>
												</button>
											</div>
										</div>
										<div class="col-sm-6 form-actions well" id="phaseTwoForm">
											<div class="form-group">
												<label class="col-sm-6 control-label no-padding-right"
													for="idDdispatchedItemReceivedBy"> Dispatched Item Received/Confirmed By<span
													class="red">*</span>:
												</label>
												<div class="col-sm-6">
													<input id="idDdispatchedItemReceivedBy" type="text"
														name="dispatchedItemReceivedBy"
														class="col-xs-12 col-sm-12"
														placeholder="Dispatched Item Received/Confirmed By"/>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-6 control-label no-padding-right"
													for="idDdispatchedDeliveryDate"> Dispatched Item Delivered Date<span
													class="red">*</span>:
												</label>
												<div class="col-sm-6">
												<div class="input-group">
													<input id="idDdispatchedDeliveryDate" type="text"
														name="dispatchedItemDeliveredDate"
														class="col-xs-12 col-sm-12 date-picker"
														data-date-format="YYYY-MM-DD" data-error="Please select Date."
														placeholder="Select date..."/><span
																				class="input-group-addon"> <i
																				class="fa fa-clock-o bigger-110"></i>
																			</span>
														</div>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-6 control-label no-padding-right"
													for="idDispRemarks"> Dispatched Remarks <small
													class="red"> *</small> :
												</label>
												<div class="col-sm-6">
														<textarea name="dispatchedRemarks"
													placeholder="Write the descriptions here..."
													class="col-xs-12 col-sm-12 limited" maxlength="1200"
													id="idDispRemarks" rows="4"
													data-error="Please fill the remarks"></textarea>
												<div class="help-block with-errors"></div>
												</div>
											</div>
										</div>
									</form>
						</div>
					</div>
				</div>
		</div>                     
<!-- basic scripts -->
	<th:block layout:fragment="scripts">
	<script>
		$(document).ready(function () {
					

	     });
	</script>		
	 <script th:inline="javascript">
		/*<![CDATA[*/
		var branchNameType = /*[[${cardDeliveryValById.destinationBranch}]]*/ 'DestinationBranch';
		var dispatchedMediumType = /*[[${cardDeliveryValById.dispatchedMedium}]]*/ 'DispatchedMedium';
		var deliveryStatusType = /*[[${cardDeliveryValById.deliveryStatus}]]*/ 'DeliveryStatus';
		
		var dispatchedItemReceivedByType = /*[[${cardDeliveryValById.dispatchedItemReceivedBy}]]*/ 'DispatchedItemReceivedBy';
		var dispatchedItemDeliveredDateType = /*[[${cardDeliveryValById.dispatchedItemDeliveredDate}]]*/ 'DispatchedItemDeliveredDate';
		var dispatchedRemarksType = /*[[${cardDeliveryValById.dispatchedRemarks}]]*/ 'DispatchedRemarks';
		/*]]>*/
		function setSelectedIndex(s, v) {
		    for ( var i = 0; i < s.options.length; i++ ) {
		        if ( s.options[i].value == v ) {
		            s.options[i].selected = true;
		            break;
		        }
		    }
		    return;
		}
		setSelectedIndex(document.getElementById('idBranchnameVal'), branchNameType);
		setSelectedIndex(document.getElementById('idDispatchedMedium'), dispatchedMediumType);
		setSelectedIndex(document.getElementById('idDeliveryStatus'), deliveryStatusType);
		
		
		if(deliveryStatusType === 'Delivered'){
			$('#phaseTwoForm').show();
			showStatusDeliveryBox(deliveryStatusType);
		}
		else{
			$('#phaseTwoForm').hide();
		}
		
		function showStatusDeliveryBox(deliveryStatus) {
			if (deliveryStatus === 'Delivered') {
				
				$("[name='dispatchedItemReceivedBy']").attr("required", true).val(dispatchedItemReceivedByType);
				$("[name='dispatchedItemDeliveredDate']").attr("required", true).val(dispatchedItemDeliveredDateType);
				$("[name='dispatchedRemarks']").attr("required", true).val(dispatchedRemarksType);
			} else {
				$('#phaseTwoForm').hide();
				$("[name='dispatchedItemReceivedBy']").attr("required", false);
				$("[name='dispatchedItemDeliveredDate']").attr("required", false);
				$("[name='dispatchedRemarks']").attr("required", false);
			}
		}	
		
		$("#idDeliveryStatus").change(function() {
			let statusValue = $('#idDeliveryStatus').val();
			showIntransitBox(statusValue);
		});
	
		
	function showIntransitBox(deliveryStatus) {
		if (deliveryStatus === 'Delivered') {
			$('#phaseTwoForm').show();
			$("[name='dispatchedItemReceivedBy']").attr("required", true);
			$("[name='dispatchedItemDeliveredDate']").attr("required", true);
			$("[name='dispatchedRemarks']").attr("required", true);
		} else {
			$('#phaseTwoForm').hide();
		}
	}
		
	</script>
	

	<script>
			autosize(document.querySelectorAll('textarea'));
	</script>

	 <script>
			$(document).ready(function() {
				$('.select2').css('width', '100%').select2({});

				$(".date-picker").datepicker({
					format : "yyyy-mm-dd",
					autoclose : true,
					todayBtn : "linked",
					todayHighlight : true
				}).datepicker('update', new Date());
				
				$(".date-picker1").datepicker({
					format : "yyyy-mm-dd",
					autoclose : true,
					todayBtn : "linked",
					todayHighlight : true
				});

			});
		</script>
	</th:block>
</body>
</html>

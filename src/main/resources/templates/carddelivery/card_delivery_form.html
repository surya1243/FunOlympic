<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">
<head>
<meta charset="ISO-8859-1" />
<title>Card Delivery</title>
<th:block layout:fragment="styles">
<link rel="stylesheet" href="../static/css/daterangepicker.min.css"
		th:href="@{/css/daterangepicker.min.css}" />
		
<style>
.autocomplete-suggestions { border: 1px solid #999; background: #FFF; overflow: auto; }
.autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; font-size:18px}
.autocomplete-selected { background: #F0F0F0; }
.autocomplete-suggestions strong { font-weight: bold; color: #3399FF; }
.autocomplete-group { padding: 2px 5px; }
.autocomplete-group strong { display: block; border-bottom: 1px solid #000; }
</style>		
</th:block>
</head>
<body>
	<div layout:fragment="content">
		<div class="page-content">
			<div class="row">
				<div class="col-xs-12">
					<!-- PAGE CONTENT BEGINS -->
					<div th:if="${message}">
						<h2 class="alert alert-danger" th:text="${message}" />
					</div>
					<div th:if="${successMessage}">
						<div class="alert alert-success">
							<button type="button" class="close" data-dismiss="alert">
								<i class="ace-icon fa fa-times"></i>
							</button>
							<strong th:text="${successMessage}">Success!</strong> <br />
						</div>
					</div>
					<!-- PAGE CONTENT ENDS -->
				</div>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="tabbable">
						<ul class="nav nav-tabs padding-12 "
							id="myTab4">
							
							<li class="dropdown active" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','GAD','MAKER','VIEWER','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<a data-toggle="dropdown" class="dropdown-toggle" href="#">
									Card Delivery Record &nbsp; &nbsp;
									<i class="ace-icon fa fa-caret-down bigger-110 width-auto"></i>
								</a>

								<ul class="dropdown-menu dropdown-info">
									<li>
										<a data-toggle="tab" href="#dropdownInTransit">In-Transit &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="badge badge-pink idInTransitVal1"></span> </a>
									</li>

									<li>
										<a data-toggle="tab" href="#dropdownDelivered" id="btnDeliveredList">Delivered &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="badge badge-warning idInTransitVal2"></span></a>
									</li>
								</ul>
							</li>							

							<li  sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')"><a data-toggle="tab" href="#deliveryForm">Card
									Delivery Form</a></li>

							<li  sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','GAD','MAKER','VIEWER','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')"><a data-toggle="tab" href="#deliveryPieChart">Card
									Delivery Statistics&nbsp;&nbsp;<i class="ace-icon fa fa-pie-chart red bigger-120"></i></a></li>

							<li class="dropdown"  sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<a data-toggle="dropdown" class="dropdown-toggle" href="#">
									Edit Card Delivery Record &nbsp;
									<i class="ace-icon fa fa-caret-down bigger-110 width-auto"></i>
								</a>

								<ul class="dropdown-menu dropdown-info">
									<li>
										<a data-toggle="tab" href="#dropdown1" id="drop1"> In-Transit &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="badge badge-pink idInTransitVal1" id="idInTransitVal1"></span> </a>
									</li>

									<li>
										<a data-toggle="tab" href="#dropdown2" id="drop2"> Delivered &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="badge badge-warning idInTransitVal2" id="idInTransitVal2"></span></a>
									</li>
								</ul>
							</li>
						</ul>

						<div class="tab-content">
							<div id="dropdownInTransit" class="tab-pane fade in active" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','GAD','MAKER','VIEWER','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<div class="search-area well well-sm">
									<div class="search-filter-header bg-primary">
										<h5 class="smaller no-margin-bottom">
											<i class="ace-icon fa fa-sliders light-green bigger-130"></i>&nbsp;
											Refine your Search
										</h5>
									</div>
									<div class="space-6"></div>
									<fieldset class="form-inline">
										<div class="col-sm-12">
										
											<div class="input-group col-xs-10 col-sm-4">
												<span class="input-group-addon">
													<i class="ace-icon fa fa-check"></i>
												</span>
												<input type="text" name="referenceNumber"  id ="searchReferenceNumber" class="form-control search-query" placeholder="Type Reference Number...">
												<span class="input-group-btn">
													<button type="button" class="btn btn-purple btn-sm" id="btnSearchRefNumber">
														<span class="ace-icon fa fa-search icon-on-right bigger-110"></span>
														Search
													</button>
												</span>
											</div>
		
											<div class="input-group col-xs-10 col-sm-3"> 
											
												<select class="form-control select2" id="idBranchNameSearch" name="destinationBranch" 
													data-placeholder="Choose Branch..."  required>
														 <option value=""></option>
														 <option th:each="branchList : ${branchLists}"
					                           										 th:value="${branchList.branchName}"
					                          										 th:text="${branchList.branchName}">Branch</option>
													</select>
			                                 </div>
											<div class="inline pull-right">
												<label for="idDateRange"> Dispatched Date Range Picker: </label>
												<div class="input-group">
													<span class="input-group-addon"><i
														class="fa fa-calendar bigger-110"></i></span> <input
														class="form-control dateRange" type="text" name="date-range-picker"
														data-date-format="yyyy-mm-dd" id="idDateRange" />
												</div>
											</div>
										</div>
									</fieldset>
								</div>							
								<div class="row table-responsive">
									<div class="table-header">Card Delivery Record List - In Transit</div>
									<table width="100%" id="cardDelivery-table" aria-hidden="true"
										class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th width="4%" class="detail-col"></th>
												<th width="11%">Dispatched Date</th>
												<th width="8%">Reference Number</th>
												<th width="12%">Destination Branch</th>
												<th width="10%">Dispatched Medium</th>
												<th width="16%">Details of Carrier/Staff</th>
												<th width="10%">No. of Card Dispatched</th>
												<th width="10%">No. of Pin Dispatched</th>
												<th width="10%">Delivery Status</th>
												<th width="8%" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')"></th>
											</tr>
										</thead>
									</table>
								</div>
								
								<div class="modal fade" id="myPhase2Modal" tabindex="-1" role="form" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')"
									aria-labelledby="myModalLabel">
									<div class="modal-dialog modal-lg" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
												<h2 class="modal-title blue" id="myModalLabel">Card Delivery Record Form (Phase-2) - Delivered</h2>
											</div>
											<div class="modal-body">
												<form th:object="${cardDelivery}" method="POST" autocomplete="off"
													th:action="@{/carddeliveryfinal}" id="form-renewCard"
													data-toggle="validator" role="form">
													
													<div class="hide">
														 <div class="row">
														 <input type="text" id="idDetailVal" name="id" hidden/>
														 <input type="text" id="idlodgedVal" name="lodgedBy" hidden/>
														 <input type="text" id="idRefNumberVal" name="referenceNumber" hidden/>
															<div class="col-xs-6 col-sm-3">
																<div class="form-group">
																	<label class="control-label block" for="idDestBranchVal">Destination Branch<small class="red"> *</small>
																	</label> <input class="form-control"
																		id="idDestBranchVal" name="destinationBranch" readonly
																		 required>
																</div>
															</div>
															<div class="col-xs-6 col-sm-3">
																<div class="form-group">
																	<label class="control-label block" for="idDispDateVal">Dispatched Date<small class="red"> *</small>
																	</label> <input id="idDispDateVal" type="text"
																				name="dispatchedDate" data-date-format="YYYY-MM-DD"
																				placeholder="Select date..." readonly
																				class="form-control"/>
																</div>
															</div>
															<div class="col-xs-6 col-sm-3">
																<div class="form-group">
																	<label class="control-label block" for="idDispMedVal">Dispatched Medium
																		</label> <input class="form-control" readonly
																		id="idDispMedVal" name="dispatchedMedium" required>
																</div>
															</div>
															<div class="col-xs-6 col-sm-3">
																<div class="form-group">
																	<label class="control-label block" for="idDetailStaffVal">Details of Courrier/Staff
																		 </label> <input type="text"
																		class="form-control" readonly
																		name="detailsOfCourrierStaff" id="idDetailStaffVal" >
																</div>
															</div>
															<div class="col-xs-6 col-sm-3">
																<div class="form-group">
																	<label class="control-label block" for="idNoCardVal">Number of Card Dispatched
																		 </label> <input type="text"
																		class="form-control" readonly
																		name="numberOfCardDispatched" id="idNoCardVal">
																</div>
															</div>
															<div class="col-xs-6 col-sm-3">
																<div class="form-group">
																	<label class="control-label block" for="idNoPinVal">Number of Pin Dispatched
																		 </label> <input type="text"
																		class="form-control" readonly
																		name="numberOfPinDispatched" id="idNoPinVal" >
																</div>
															</div>
															<div class="col-xs-6 col-sm-3">
																<div class="form-group">
																	<label class="control-label block" for="idDelStatusVal">Delivery Status 
																		 </label> <input type="text"
																		class="form-control" readonly
																		name="deliveryStatus " id="idDelStatusVal" >
																</div>
															</div>
														</div>
													</div>
		
													<div class="row">
														<div class="form-horizontal">
															<div class="col-xs-12 col-sm-12">
																<div class="form-group">
																	<label class="col-sm-4 control-label no-padding-right"
																		for="idDispatchedItemReceivedBy"> Dispatched Item Received/Confirmed By <small
																		class="red"> *</small> :
																	</label>
																	<div class="col-sm-6">
																		<div class="input-group">
																			<input id="idDispatchedItemReceivedBy" type="text"
																				name="dispatchedItemReceivedBy" 
																				placeholder="Dispatched Item Received/Confirmed By"
																				class="form-control"
																				data-error="Please enter Dispatched Item Received/Confirmed By" /> <span
																				class="input-group-addon"> <i
																				class="fa fa-user bigger-110"></i>
																			</span>
																		</div>
																	</div>
																	<div class="help-block with-errors"></div>
																</div>
																<div class="form-group">
																	<label class="col-sm-4 control-label no-padding-right"
																		for="idDeliveryDate"> Dispatched Item Delivered Date <small
																		class="red"> *</small> :
																	</label>
																	<div class="col-sm-6">
																		<div class="input-group">
																			<input id="idDeliveryDate" type="text"
																				name="dispatchedItemDeliveredDate" data-date-format="YYYY-MM-DD"
																				placeholder="Select date..."
																				class="form-control date-picker"
																				data-error="Please select Date." /> <span
																				class="input-group-addon"> <i
																				class="fa fa-clock-o bigger-110"></i>
																			</span>
																		</div>
																	</div>
																	<div class="help-block with-errors"></div>
																</div>
																
																
																<div class="form-group">
																	<label class="col-sm-4 control-label no-padding-right"
																		for="idDispatchedRemarks"> Dispatched Remarks <small
																		class="red"> *</small> :
																	</label>
																	<div class="col-sm-6">
																			<textarea name="dispatchedRemarks"
																		placeholder="Write the descriptions here..."
																		class="form-control limited" maxlength="1200"
																		id="idDispatchedRemarks" rows="3" required
																		data-error="Please fill the remarks"></textarea>
																	<div class="help-block with-errors"></div>
																	</div>
																</div>
																<div class="form-group">
																	<label class="col-sm-4 control-label no-padding-right"
																		for="idLodgedBy1"> Lodged By <small
																		class="red"> *</small> :
																	</label>
																	<div class="col-sm-6">
																		<div class="input-group">
																			<input id="idLodgedBy1" type="text" name="lodgedModifiedBy"
																				class="form-control" th:value="${currentUser.email}"
																				readonly />
																		</div>
																	</div>
																	<div class="help-block with-errors"></div>
																</div>
															</div>
														</div>
													</div>
												</form>
											</div>
											<div class="modal-footer">
												<button class="btn btn-sm" data-dismiss="modal">
													<i class="ace-icon fa fa-times"></i> Cancel
												</button>
												<button class="btn btn-sm btn-primary" type="submit"
													form="form-renewCard" id="btnSubmit">
													<i class="ace-icon fa fa-check"></i> Save
												</button>
		
											</div>
										</div>
									</div>
								</div>
							</div>
							
							
							<div id="dropdownDelivered" class="tab-pane fade" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','GAD','MAKER','VIEWER','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<div class="search-area well well-sm">
									<div class="search-filter-header bg-primary">
										<h5 class="smaller no-margin-bottom">
											<i class="ace-icon fa fa-sliders light-green bigger-130"></i>&nbsp;
											Refine your Search
										</h5>
									</div>
									<div class="space-6"></div>
									<fieldset class="form-inline">
										<div class="col-sm-12">
										
											<div class="input-group col-xs-10 col-sm-4">
												<span class="input-group-addon">
													<i class="ace-icon fa fa-check"></i>
												</span>
												<input type="text" name="referenceNumber"  id ="searchReferenceNumberDelivery" class="form-control search-query" placeholder="Type Reference Number...">
												<span class="input-group-btn">
													<button type="button" class="btn btn-purple btn-sm" id="btnSearchRefNumberDelivery">
														<span class="ace-icon fa fa-search icon-on-right bigger-110"></span>
														Search
													</button>
												</span>
											</div>
		
											<div class="input-group col-xs-10 col-sm-3">
											
												<select class="form-control select2" id="idBranchNameSearchDelivery" name="destinationBranch" 
													data-placeholder="Choose Branch..."  required>
														 <option value=""></option>
														 <option th:each="branchList : ${branchLists}"
					                           										 th:value="${branchList.branchName}"
					                          										 th:text="${branchList.branchName}">Branch</option>
													</select>
			                                 </div>
			
											<div class="inline pull-right">
												<label for="idDateRangeDelivery"> Dispatched Date Range Picker: </label>
												<div class="input-group">
													<span class="input-group-addon"><i
														class="fa fa-calendar bigger-110"></i></span> <input
														class="form-control dateRange" type="text" name="date-range-picker"
														data-date-format="yyyy-mm-dd" id="idDateRangeDelivered" />
												</div>
											</div>
										</div>
									</fieldset>
								</div>							
								<div class="row table-responsive">
									<div class="table-header">Card Delivery Record List - Delivery</div>
									<table width="100%" id="cardDelivery-tableDelivered" aria-hidden="true"
										class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th width="4%" class="detail-col"></th>
												<th width="12%">Dispatched Date</th>
												<th width="9%">Reference Number</th>
												<th width="12%">Destination Branch</th>
												<th width="13%">Dispatched Medium</th>
												<th width="20%">Details of Carrier/Staff</th>
												<th width="10%">No. of Card Dispatched</th>
												<th width="10%">No. of Pin Dispatched</th>
												<th width="11%">Delivery Status</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
									
							<div id="deliveryForm" class="tab-pane" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<div class="row">
									<div class="search-filter-header bg-primary">
										<h5 class="widget-title lighter">Fill the required
											information for Card Delivery Record.</h5>
									</div>

									<form method="POST" th:object="${cardDelivery}"
										modelAttribute="cardDelivery" autocomplete="off"
										th:action="@{/carddelivery}" class="form-horizontal"
										data-toggle="validator" role="form">
										<div class="col-sm-6 form-actions">
										<span class="col-sm-offset-4" id="showReferenceNumber"></span>
										<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idReferenceNumber"> Reference Number <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
												<input id="idReferenceNumber" type="text" name="referenceNumber"
														class="col-xs-12 col-sm-12" placeholder="Enter Reference Number"
														required/>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="branchName-dropdown"> Destination Branch <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
												
												<select class="form-control select2" id="branchNameForm" name="destinationBranch" 
													data-placeholder="Choose Branch..."  required>
														 <option value=""></option>
														 <option th:each="branchList : ${branchLists}"
					                           										 th:value="${branchList.branchName}"
					                          										 th:text="${branchList.branchName}">Branch</option>
													</select>
													
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idDispatchedDate"> Dispatched Date <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<input id="idDispatchedDate" type="text"
														name="dispatchedDate"
														class="col-xs-12 col-sm-12 date-picker"
														data-date-format="yyyy-mm-dd"
														placeholder="Select Dispatched Date" required />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idDispatchedMedium"> Dispatched Medium <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<select class="select2 col-xs-12 col-sm-12"
														id="idDispatchedMedium" name="dispatchedMedium"
														data-placeholder="Choose a Dispatched Medium..." required>
														<option value=""></option>
														<option value="Courrier">Courrier</option>
														<option value="POFIL Staff">POFIL Staff</option>
														<option value="Others">Others</option>
													</select>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idCarrierStaff"> Details of Courrier/Staff <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<textarea name="detailsOfCourrierStaff"
														placeholder="Description" required id="idCarrierStaff"
														class="col-xs-12 col-sm-12"></textarea>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idNumberOfCardDispatched"> Number of Card
													Dispatched<span class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<input id="idNumberOfCardDispatched" type="text"
														name="numberOfCardDispatched" class="col-xs-12 col-sm-12"
														pattern="^\d+$"
														onblur="this.parentNode.parentNode.style.backgroundColor=/^\d+$/.test(this.value)?'inherit':'#f28c0e14'"
														placeholder="Enter Number of Card Dispatched" required />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idNumberOfPinDispatched"> Number of Pin
													Dispatched<span class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<input id="idNumberOfPinDispatched" type="text"
														name="numberOfPinDispatched" class="col-xs-12 col-sm-12"
														pattern="^\d+$"
														onblur="this.parentNode.parentNode.style.backgroundColor=/^\d+$/.test(this.value)?'inherit':'#f28c0e14'"
														placeholder="Enter Number of Pin Dispatched" required />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-4 control-label no-padding-right"
													for="idDeliveryStatus"> Delivery Status <span
													class="red">*</span>:
												</label>
												<div class="col-sm-8">
													<select class="select2 col-xs-12 col-sm-12"
														id="idDeliveryStatus" name="deliveryStatus"
														data-placeholder="Choose a Dispatched Medium..." required>
														<option value=""></option>
														<option value="In_Transit">In-Transit</option>
														<option value="Delivered">Delivered</option>
													</select>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											
											
											<div class="form-group hide">
												<label class="col-sm-4 control-label no-padding-right"
													for="idLodgedBy"> Lodged By: </label>
												<div class="col-sm-8">
													<input id="idLodgedBy" type="text" name="lodgedBy"
														class="col-xs-12 col-sm-12"
														th:value="${currentUser.email}" required readonly />
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="clearfix">
												<button type="submit" id="btnUploadFile"
													class="width-65 pull-right btn btn-sm btn-success">
													<span class="bigger-110"> Submit </span> <i
														class="ace-icon fa fa-arrow-right icon-on-right"></i>
												</button>
											</div>
										</div>
										<div class="col-sm-6 form-actions well" id="phaseTwoForm">
											<div class="form-group">
												<label class="col-sm-6 control-label no-padding-right"
													for="idDdispatchedItemReceivedBy"> Dispatched Item Received/Confirmed By<span
													class="red">*</span>:
												</label>
												<div class="col-sm-6">
													<input id="idDdispatchedItemReceivedBy" type="text"
														name="dispatchedItemReceivedBy"
														class="col-xs-12 col-sm-12"
														placeholder="Dispatched Item Received/Confirmed By"/>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-6 control-label no-padding-right"
													for="idDdispatchedDeliveryDate"> Dispatched Item Delivered Date<span
													class="red">*</span>:
												</label>
												<div class="col-sm-6">
												<div class="input-group">
													<input id="idDdispatchedDeliveryDate" type="text"
														name="dispatchedItemDeliveredDate"
														class="col-xs-12 col-sm-12 date-picker1"
														data-date-format="YYYY-MM-DD" data-error="Please select Date."
														placeholder="Select date..."/><span
																				class="input-group-addon"> <i
																				class="fa fa-clock-o bigger-110"></i>
																			</span>
														</div>
													<div class="help-block with-errors"></div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-6 control-label no-padding-right"
													for="idDispRemarks"> Dispatched Remarks <small
													class="red"> *</small> :
												</label>
												<div class="col-sm-6">
														<textarea name="dispatchedRemarks"
													placeholder="Write the descriptions here..."
													class="col-xs-12 col-sm-12 limited" maxlength="1200"
													id="idDispRemarks" rows="4"
													data-error="Please fill the remarks"></textarea>
												<div class="help-block with-errors"></div>
												</div>
											</div>
										</div>
										
									</form>
								</div>
							</div>
							

							<div id="deliveryPieChart" class="tab-pane fade" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','GAD','MAKER','VIEWER','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<div class="row">
									<div id="container" ></div>
								</div>
							</div>


							<div id="dropdown1" class="tab-pane fade" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<div class="row table-responsive">
									<div class="table-header">Card Delivery Record List - In Transit</div>
									<table width="100%" id="cardDeliveryEdit-tablePh1" aria-hidden="true"
										class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th width="4%" class="detail-col"></th>
												<th width="11%">Dispatched Date</th>
												<th width="8%">Reference Number</th>
												<th width="12%">Destination Branch</th>
												<th width="10%">Dispatched Medium</th>
												<th width="16%">Details of Carrier/Staff</th>
												<th width="10%">No. of Card Dispatched</th>
												<th width="10%">No. of Pin Dispatched</th>
												<th width="10%">Delivery Status</th>
												<th width="4%" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR','CARDCUSTODIAN')">Edit</th>
												<th width="4%" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR','CARDSUPERVISOR')">Delete</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>

							<div id="dropdown2" class="tab-pane fade" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR', 'CARDCUSTODIAN')">
								<div class="row table-responsive">
									<div class="table-header">Card Delivery Record List - Delivered</div>
									<table width="100%" id="cardDeliveryEdit-tablePh2" aria-hidden="true"
										class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th width="4%" class="detail-col"></th>
												<th width="11%">Dispatched Date</th>
												<th width="8%">Reference Number</th>
												<th width="12%">Destination Branch</th>
												<th width="10%">Dispatched Medium</th>
												<th width="16%">Details of Carrier/Staff</th>
												<th width="10%">No. of Card Dispatched</th>
												<th width="10%">No. of Pin Dispatched</th>
												<th width="10%">Delivery Status</th>
												<th width="4%" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR', 'SUPERVISOR','CARDMAKER','CARDSUPERVISOR','CARDCUSTODIAN')">Edit</th>
												<th width="4%" sec:authorize="hasAnyAuthority('ADMIN','HIGHSUPERVISOR','CARDSUPERVISOR')">Delete</th>
											</tr>
										</thead>
									</table>
								</div>							
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<th:block layout:fragment="scripts">
		<script src="../static/js/jquery.autocomplete.min.js"
			th:src="@{/js/jquery.autocomplete.min.js/}"></script>	

		<script>
	$("#idReferenceNumber").focusout(function(){
		$.post('/getReferenceNumber',   // url
	            {
					referenceNumber: $("#idReferenceNumber").val()
	            },
	            function (result, status, jqXHR) {// success callback
	                if (result.status) {
	                    $('#showReferenceNumber').html("<span class='label label-yellow'><i class='ace-icon fa fa-exclamation-triangle bigger-120 icon-animated-bell'></i> " + result.message
	                        + "</span>");
	                    return false;
	                } else {
	                    $('#showReferenceNumber').html("<strong style='color: #d50c56'>* Make sure to enter all the required fields.</strong>");
	                    return true;
	                }
	            });
		
		});
	</script>
		<script>
	$(window).load(function () {
		$("#container").html('<div class="blue bigger-150">Loading  <i class="ace-icon fa fa-spinner fa-spin blue bigger-150"></i>  </div>')
		var container = $("#container");
		


		$.ajax({
			url: '/countdeliverystatus/deliveryStatus',
		   	type: "GET",
		   	dataType: 'json',
		    contentType: 'application/json',   	
		   	success: function(response){
				var processed_json = new Array();
		   		for (var key in response) {
		   		    if (response.hasOwnProperty(key)) {
		   		    	processed_json.push([key, response[key]])
		   		    }
		   		}

		   		if(response){
		   			for(var key in response){
		   				$(".idInTransitVal1").html(response.In_Transit);
		   				$(".idInTransitVal2").html(response.Delivered);
		   			}
					   
		   		}
				   if(response){
					Highcharts.setOptions({
							colors: [ '#50B432', '#ED561B', '#058DC7','#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4']
						});

		   			Highcharts.chart('container', {
		   			    chart: {
		   			        type: 'pie',
		   			        options3d: {
		   			            enabled: true,
		   			            alpha: 45,
		   			            beta: 0
		   			        }
		   			    },
		   			    title: {
		   			        text: 'Card Delivered Status'
		   			    },
		   			 legend: {
		   		        labelFormat: '{name}: <span style="opacity: 0.9">{y}</span>'
		   		    },
		   			    credits: {
		   			        enabled: false
		   			    },	   			    
		   			    tooltip: {
		   			        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		   			    },
		   			    plotOptions: {
		   			        pie: {
		   			            allowPointSelect: true,
		   			            cursor: 'pointer',
		   			            depth: 35,
		   			            dataLabels: {
		   			                enabled: true,
		   			                format: '{point.name}'
		   			            }
		   			        }
		   			    },
		   			    series: [{
		   			        type: 'pie',
		   			        name: 'Card Delivered Status',
		   			        data: processed_json,
		   			     showInLegend: true
		   			    }]
		   			});
		   		}else{
					$("#container").html("<strong>Oops, an error occured fetching the data.</strong>");
				}


		   	}
		});
	});

	</script>
	<!-- search by Reference Number -->
	<script>
		$(document).ready(function() {
	
			$('#searchReferenceNumber').autocomplete({
				serviceUrl: '/getrefeInTransit',
				paramName: "referenceNumber",
				delimiter: ",",
			    transformResult: function(response) {
			        return {
			        	
			            suggestions: $.map($.parseJSON(response), function(item) {
			            	
			                return { value: item.referenceNumber, data: item.referenceNumber };
			            })
			        };
			    }
			});
			
		$('#searchReferenceNumberDelivery').autocomplete({
				serviceUrl: '/getrefeDelivery',
				paramName: "referenceNumber",
				delimiter: ",",
			    transformResult: function(response) {
			    	
			        return {
			            suggestions: $.map($.parseJSON(response), function(item) {
			            	
			                return { value: item.referenceNumber, data: item.referenceNumber };
			            })
			        };
			    }
			}); 
		});
	</script>
	
	<script>
	$(function() {
		var start = moment().subtract(29, 'days');
		var end = moment();

		$('.dateRange')
				.daterangepicker(
						{
							startDate : start,
							endDate : end,
							opens : 'left',
							autoclose : true,
							todayHighlight : true,
							ranges : {
								'Today' : [ moment(), moment() ],
								'Yesterday' : [
										moment().subtract(1, 'days'),
										moment().subtract(1, 'days') ],
								'Last 7 Days' : [
										moment().subtract(6, 'days'),
										moment() ],
								'Last 30 Days' : [
										moment().subtract(29, 'days'),
										moment() ],
								'This Month' : [
										moment().startOf('month'),
										moment().endOf('month') ],
								'Last Month' : [
										moment().subtract(1, 'month')
												.startOf('month'),
										moment().subtract(1, 'month')
												.endOf('month') ]
							},
							locale : {
								format : 'YYYY-MM-DD'
							}
						}, function(start, end, label) {
							if(!$('#idBranchNameSearch').val()){
								ajaxGetCardDeliveryDateBtn(start, end);

							}else{
								ajaxGetDeliveryDateBtnBranch(start, end, $('#idBranchNameSearch').val());
							}
						});

			});
	$(function() {
		var start = moment().subtract(29, 'days');
		var end = moment();

		$('#idDateRangeDelivered')
				.daterangepicker(
						{
							startDate : start,
							endDate : end,
							opens : 'left',
							autoclose : true,
							todayHighlight : true,
							ranges : {
								'Today' : [ moment(), moment() ],
								'Yesterday' : [
										moment().subtract(1, 'days'),
										moment().subtract(1, 'days') ],
								'Last 7 Days' : [
										moment().subtract(6, 'days'),
										moment() ],
								'Last 30 Days' : [
										moment().subtract(29, 'days'),
										moment() ],
								'This Month' : [
										moment().startOf('month'),
										moment().endOf('month') ],
								'Last Month' : [
										moment().subtract(1, 'month')
												.startOf('month'),
										moment().subtract(1, 'month')
												.endOf('month') ]
							},
							locale : {
								format : 'YYYY-MM-DD'
							}
						}, function(start, end, label) {
							if(!$('#idBranchNameSearchDelivery').val()){
								ajaxGetDeliveryDateBtn(start, end);
							}else{
								ajaxGetDeliveryDateBtnBranchDelivered(start, end, $('#idBranchNameSearchDelivery').val());
							}
						});

			});
		</script>
		
		<script>
			$('.modal-dialog').draggable({
				"handle" : ".modal-header"
			});
			
			
			$("#drop1").on('click', function () {
				ajaxGetEditCardDeliveryPh1();
			});
			$("#drop2").on('click', function () {
				ajaxGetEditCardDeliveryPh2();
			});
			
			function ajaxGetEditCardDeliveryPh1(){
	 			const url = '/getcarddelivery/phase1';
	 			$.getJSON(url, function (data) {
	 				createEditCardDeliveryTablePh1(data);
	 			});
	 		}
			function ajaxGetEditCardDeliveryPh2(){
	 			const url = '/editcarddelivery/phase2';
	 			$.getJSON(url, function (data) {
	 				createEditCardDeliveryTablePh2(data);
	 			});
	 		}
			
	 		function createEditCardDeliveryTablePh1(data){
		         var table = $('#cardDeliveryEdit-tablePh1').DataTable({
		        	 "order": [ 1, "desc" ],
		        	 destroy: true,
		             "data": data,
		             select:"single",
		             "columns": [
		                 {
		                     "className": 'details-control',
		                     "orderable": false,
		                     "data": null,
		                     "defaultContent": '',
		                     "render": function () {
		                         return '<i class="ace-icon fa fa-angle-double-down fa-2x" title="Show details" aria-hidden="true"></i>';
		                     },
		                     width:"15px"
		                 },
		                { "data": "dispatchedDate",
		                	 "render" : function(data, type, row, meta) {
									if (data === null) return "";
									var thisDate = moment(new Date(data)).format("YYYY-MM-DD");
									return thisDate
								}
		                 },
		                 { "data": "referenceNumber" },
		                 { "data": "destinationBranch" },
		                { "data": "dispatchedMedium"
		                 },
		                 { "data": "detailsOfCourrierStaff" },
		                 { "data": "numberOfCardDispatched"
		                 },
		                 { "data": "numberOfPinDispatched" },
		                 { "data": "deliveryStatus" },
		                 { 	"className": 'center',
		                	"data": "null",
		                	"orderable": false,
			                	"render": function(data,type,row,meta) { // render event defines the markup of the cell text 
		 	                       var a = '<a class="btn btn-xs btn-success" href="carddeliverylist/edit/' + row["id"]+ '" title="Edit details.">&nbsp;<i class="ace-icon fa fa-pencil bigger-120" aria-hidden="true"></i></a>';
		 	                       return a;}
		                  },
		                 { 	"className": 'center',
		                	"data": "null",
		                	"orderable": false,
			                	"render": function(data,type,row,meta) { // render event defines the markup of the cell text 
		 	                       var a = '<a class="btn btn-xs btn-danger editor_delete" title="Delete details.">&nbsp;<i class="ace-icon fa fa-trash-o bigger-120" aria-hidden="true"></i></a>';
		 	                       return a;}
		                  }
		             ],             
		             dom: 'Blfrtip',
		             buttons: [
		            	 {
								"extend": "copy",
								"text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
								"className": "btn btn-white btn-primary btn-bold"
							  },
							  {
								"extend": "csv",
								"text": "<i class='fa fa-file-excel-o bigger-110 blue'></i> <span class='hidden'>Export to CSV</span>",
								"className": "btn btn-white btn-primary btn-bold"
							  },
							  {
								"extend": "excel",
								"text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
								"className": "btn btn-white btn-primary btn-bold",
								"exportOptions": { modifier: { page: 'all'} }
							  },
							  {
								"extend": "pdf",
								"text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
								"className": "btn btn-white btn-primary btn-bold",
								"exportOptions": { modifier: { page: 'all'} }
							  },
							  {
								"extend": "print",
								"text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
								"className": "btn btn-white btn-primary btn-bold",							
								autoPrint: false,
								orientation:'landscape',
								title: 'Card Delivery Record List - (In Transit)'
							  }		  
		             ]
		            
		         });
		        
		         // Add event listener for opening and closing details
		         $('#cardDeliveryEdit-tablePh1 tbody').on('click', 'td.details-control', function () {
		             var tr = $(this).closest('tr');
		             var tdi = tr.find("i.fa");
		             var row = table.row(tr);

		             if (row.child.isShown()) {
		                 // This row is already open - close it
		                 row.child.hide();
		                 tr.removeClass('shown');
		                 tdi.first().removeClass('fa fa-angle-double-up fa-2x');
		                 tdi.first().addClass('fa fa-angle-double-down fa-2x');
		             }
		             else {
		                 // Open this row
		                 row.child(format(row.data())).show();
		                 tr.addClass('shown');
		                 tdi.first().removeClass('fa fa-angle-double-down fa-2x');
		                 tdi.first().addClass('fa fa-angle-double-up fa-2x');
		             }
		         });

		         table.on("user-select", function (e, dt, type, cell, originalEvent) {
		             if ($(cell.node()).hasClass("details-control")) {
		                 e.preventDefault();
		             }
		         });
		         
		  	    function format(d){
		 	         // `d` is the original data object for the row
		 	         return '<table class="table table-striped table-bordered table-hover">' +
		 	             '<tr>' +
		 		             '<td width="25%"><strong>Reference Number: </strong></td>' +
		 		             '<td>' + d.referenceNumber + '</td>' +
		 		         '</tr>' +
			 	        '<tr>' +
		                '<td width="20"><strong>Dispatched Date: </strong></td>' +
		                '<td>' + moment(new Date(d.dispatchedDate)).format("YYYY-MM-DD") + '</td>' +
		            	'</tr>' +
		 	             '<tr>' +
		 		             '<td width="25%"><strong>Destination Branch: </strong></td>' +
		 		             '<td>' + d.destinationBranch + '</td>' +
		 		         '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Dispatched Medium: </strong></td>' +
		 			         '<td>' + d.dispatchedMedium + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Details of Carrier/Staff: </strong></td>' +
		 			         '<td>' + d.detailsOfCourrierStaff + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Number of Card Dispatched: </strong></td>' +
		 			         '<td>' + d.numberOfCardDispatched + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Number of Pin Dispatched: </strong></td>' +
		 			         '<td>' + d.numberOfPinDispatched + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Delivery Status: </strong></td>' +
		 			         '<td>' + d.deliveryStatus + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Data Lodged By: </strong></td>' +
		 			         '<td>' + d.lodgedBy  + '</td>' +
		 			     '</tr>' +
				     
		 	         '</table>';  
		 	    }
		  	    
		  	    
		  	    // Delete record - In Transit
		  	    $('#cardDeliveryEdit-tablePh1').on('click', 'a.editor_delete', function (e) {
		  	        e.preventDefault();
		  	    
		  	      var row_val = table.row($(this).closest('tr'));
		          var data_val= row_val.data();
		          
		  	       deleteCardDelivery(data_val.id);
		  	       
		  	
		  	    } );
	 		}  
	 		
				function deleteCardDelivery(control) {				
			  	      
			             
					var dialog = bootbox
							.dialog({
								title : 'Delete Card Delivery Data!!!',
								message : '<p>Are you sure you want to delete recorded card delivery data?</p>',
								size : 'md',
								onEscape : true,
								backdrop : true,
								buttons : {
									cancel : {
										label : '<i class="fa fa-times"></i> Cancel',
										className : 'btn-danger pull-right margin-left-10px',
									},
									ok : {
										label : '<i class="fa fa-check"></i> Confirm',
										className : 'btn-info',
										callback : function(result) {
											if (result) {
												$
														.ajax({
															type : 'DELETE',
															url : '/updatecarddelivery/delete/' + control,
															success : function(
																	result) {
																$('#showMessage')
																		.append(
																				"<div class='alert alert-danger'><button type='button' class='close' data-dismiss='alert'><i class='ace-icon fa fa-times'></i></button><br>"
																						+ result.message
																						+ ': '
																						+ result.data
																						+ "</div>");
																alert(result.message
																		+ ': '
																		+ result.data);
																window.location.href = "/carddelivery";
															},
															error : function(jqXHR,
																	textStatus,
																	errorThrown) {
																alert(jqXHR.status
																		+ ' '
																		+ jqXHR.responseText);
															}
														});
											}
										}
									}
								},
							});
				}
			
	 		
	 		function createEditCardDeliveryTablePh2(data){
		         var table = $('#cardDeliveryEdit-tablePh2').DataTable({
		        	 "order": [ 1, "desc" ],
		        	 destroy: true,
		             "data": data,
		             select:"single",
		             "columns": [
		                 {
		                     "className": 'details-control',
		                     "orderable": false,
		                     "data": null,
		                     "defaultContent": '',
		                     "render": function () {
		                         return '<i class="ace-icon fa fa-angle-double-down fa-2x" title="Show details" aria-hidden="true"></i>';
		                     },
		                     width:"15px"
		                 },
		                { "data": "dispatchedDate",
		                	 "render" : function(data, type, row, meta) {
									if (data === null) return "";
									var thisDate = moment(new Date(data)).format("YYYY-MM-DD");
									return thisDate
								}
		                 },
		                 { "data": "referenceNumber" },
		                 { "data": "destinationBranch" },
		                { "data": "dispatchedMedium"
		                 },
		                 { "data": "detailsOfCourrierStaff" },
		                 { "data": "numberOfCardDispatched"
		                 },
		                 { "data": "numberOfPinDispatched" },
		                 { "data": "deliveryStatus" },
		                 { 	"className": 'center',
		                	"data": "null",
		                	"orderable": false,
			                	"render": function(data,type,row,meta) { // render event defines the markup of the cell text 
			                		var a = '<a class="btn btn-xs btn-success" href="carddeliverylist/edit/' + row["id"]+ '" title="Edit details.">&nbsp;<i class="ace-icon fa fa-pencil bigger-120" aria-hidden="true"></i></a>';
			 	                       return a;}
		                  },
		                 { 	"className": 'center',
		                	"data": "null",
		                	"orderable": false,
			                	"render": function(data,type,row,meta) { // render event defines the markup of the cell text 
			                		var a = '<a class="btn btn-xs btn-danger phase2_delete" title="Delete details.">&nbsp;<i class="ace-icon fa fa-trash-o bigger-120" aria-hidden="true"></i></a>';
			 	                       return a;}
		                  }
		             ],             
		             dom: 'Blfrtip',
		             buttons: [
		            	 {
								"extend": "copy",
								"text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
								"className": "btn btn-white btn-primary btn-bold"
							  },
							  {
								"extend": "csv",
								"text": "<i class='fa fa-file-excel-o bigger-110 blue'></i> <span class='hidden'>Export to CSV</span>",
								"className": "btn btn-white btn-primary btn-bold"
							  },
							  {
								"extend": "excel",
								"text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
								"className": "btn btn-white btn-primary btn-bold",
								"exportOptions": { modifier: { page: 'all'} }
							  },
							  {
								"extend": "pdf",
								"text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
								"className": "btn btn-white btn-primary btn-bold",
								"exportOptions": { modifier: { page: 'all'} }
							  },
							  {
								"extend": "print",
								"text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
								"className": "btn btn-white btn-primary btn-bold",							
								autoPrint: false,
								orientation:'landscape',
								title: 'Card Delivery Record List - (Delivered)'
							  }		  
		             ]
		            
		         });
		        
		         // Add event listener for opening and closing details
		         $('#cardDeliveryEdit-tablePh2 tbody').on('click', 'td.details-control', function () {
		             var tr = $(this).closest('tr');
		             var tdi = tr.find("i.fa");
		             var row = table.row(tr);

		             if (row.child.isShown()) {
		                 // This row is already open - close it
		                 row.child.hide();
		                 tr.removeClass('shown');
		                 tdi.first().removeClass('fa fa-angle-double-up fa-2x');
		                 tdi.first().addClass('fa fa-angle-double-down fa-2x');
		             }
		             else {
		                 // Open this row
		                 row.child(format(row.data())).show();
		                 tr.addClass('shown');
		                 tdi.first().removeClass('fa fa-angle-double-down fa-2x');
		                 tdi.first().addClass('fa fa-angle-double-up fa-2x');
		             }
		         });

		         table.on("user-select", function (e, dt, type, cell, originalEvent) {
		             if ($(cell.node()).hasClass("details-control")) {
		                 e.preventDefault();
		             }
		         });
		         
		  	    function format(d){
		 	         // `d` is the original data object for the row
		 	         return '<table class="table table-striped table-bordered table-hover">' +
			 	        '<tr>' +
			             '<td width="25%"><strong>Reference Number: </strong></td>' +
			             '<td>' + d.referenceNumber + '</td>' +
			         '</tr>' +
			 	        '<tr>' +
		                '<td width="20"><strong>Dispatched Date: </strong></td>' +
		                '<td>' + moment(new Date(d.dispatchedDate)).format("YYYY-MM-DD") + '</td>' +
		            	'</tr>' +
		 	             '<tr>' +
		 		             '<td width="25%"><strong>Destination Branch: </strong></td>' +
		 		             '<td>' + d.destinationBranch + '</td>' +
		 		         '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Dispatched Medium: </strong></td>' +
		 			         '<td>' + d.dispatchedMedium + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Details of Carrier/Staff: </strong></td>' +
		 			         '<td>' + d.detailsOfCourrierStaff + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Number of Card Dispatched: </strong></td>' +
		 			         '<td>' + d.numberOfCardDispatched + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Number of Pin Dispatched: </strong></td>' +
		 			         '<td>' + d.numberOfPinDispatched + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Delivery Status: </strong></td>' +
		 			         '<td>' + d.deliveryStatus + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Dispatched Item Received/Confirmed By: </strong></td>' +
		 			         '<td>' + d.dispatchedItemReceivedBy + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Dispatched Item Delivered Date: </strong></td>' +
		 			         '<td>' + moment(new Date(d.dispatchedItemDeliveredDate)).format("YYYY-MM-DD") + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Dispatched Remarks: </strong></td>' +
		 			         '<td>' + d.dispatchedRemarks + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Data Lodged By: </strong></td>' +
		 			         '<td>' + d.lodgedBy  + '</td>' +
		 			     '</tr>' +
		 		         '<tr>' +
		 			         '<td width="25%"><strong>Data Lodged Modified By: </strong></td>' +
		 			         '<td>' + d.lodgedModifiedBy   + '</td>' +
		 			     '</tr>' +
				     
		 	         '</table>';  
		 	    }
		  	    
		  	  // Delete record - In Transit
		  	    $('#cardDeliveryEdit-tablePh2').on('click', 'a.phase2_delete', function (e) {
		  	        e.preventDefault();
		  	      var row_val = table.row($(this).closest('tr'));
		          var data_val= row_val.data();
		  	       deleteCardDelivery(data_val.id);
		  	
		  	    } );		         
			}
			
		</script>

		<script>
			$(document).ready(function() {
				$('.select2').css('width', '100%').select2({});

				$(".date-picker").datepicker({
					format : "yyyy-mm-dd",
					autoclose : true,
					todayBtn : "linked",
					todayHighlight : true
				}).datepicker('update', new Date());
				
				$(".date-picker1").datepicker({
					format : "yyyy-mm-dd",
					autoclose : true,
					todayBtn : "linked",
					todayHighlight : true
				});

			});
		</script>
	
	
		<script>
		$(document).ready(function () {
	    	 ajaxGetCardDeliveryPh1();
	    		
					$('#phaseTwoForm').hide();
					$("#idDeliveryStatus").change(function() {
						let statusValue = $('#idDeliveryStatus').val();
						showResolvedDateBox(statusValue);
					});
				
				function showResolvedDateBox(deliveryStatus) {
					if (deliveryStatus === 'Delivered') {
						$('#phaseTwoForm').show();
						$("[name='dispatchedItemReceivedBy']").attr("required", true);
						$("[name='dispatchedItemDeliveredDate']").attr("required", true);
						$("[name='dispatchedRemarks']").attr("required", true);
					} else {
						$('#phaseTwoForm').hide();
						$("[name='dispatchedItemReceivedBy']").attr("required", false);
						$("[name='dispatchedItemDeliveredDate']").attr("required", false);
						$("[name='dispatchedRemarks']").attr("required", false);
					}
				}
				
				
				
	     });
		
		function ajaxGetCardDeliveryPh1(){
 			const url = '/getcarddelivery/phase1';
 			$.getJSON(url, function (data) {
 				createCardDeliveryTable(data);
 			});
 		}
		
		
		
		/* In Transit Data Table - dropdown1 */
		
		
		$("#idBranchNameSearch").change(function() {
			let statusCode ="In_Transit";	
			let branchName = $('#idBranchNameSearch').val();
				ajaxgetCardDeliveryByBranch(statusCode, branchName);
	    });
		
		
		$("#btnSearchRefNumber").click(function() {
					//e.preventDefault();
				let statusCode ="In_Transit";	
				let referenceNoVal = $('#searchReferenceNumber').val();
				ajaxgetCardDeliverByRefNum(statusCode, referenceNoVal);
				});
		$("#btnSearchRefNumberDelivery").click(function() {

					//e.preventDefault();
				let statusCode ="Delivered";
				let referenceNoVal = $('#searchReferenceNumberDelivery').val();	
				ajaxgetCardDeliverByRefNum(statusCode, referenceNoVal);
				});
		
		/* autoreload Delivered card list */
		$("#btnDeliveredList").on('click', function () {
				ajaxGetCardDeliveryDelivered();
			});
			
			function ajaxGetCardDeliveryDelivered(){
	 			const url = '/editcarddelivery/phase2';
	 			$.getJSON(url, function (data) {
	 				createCardDeliveryTableDelivered(data);
	 			});
	 		}

		$("#idBranchNameSearchDelivery").change(function() {
			let statusCodeDelivered ="Delivered";
			let branchNameVal = $("#idBranchNameSearchDelivery :selected").val();	
			ajaxgetCardDeliveryByBranch(statusCodeDelivered, branchNameVal);
	    });
/* search by branchName */
 		function ajaxgetCardDeliveryByBranch(statusCode, branchName){
 			
 			const url = '/getReferenceNumber/branchname/'+branchName +'/'+statusCode;
 			$.getJSON(url, function (data) {
				 if(statusCode === "In_Transit"){
					createCardDeliveryTable(data);
				}
				else{
					createCardDeliveryTableDelivered(data);
				}
 			});
 		}
 /* search by delivery status and reference number */		
		function ajaxgetCardDeliverByRefNum(statusCode, referenceNoVal) {
			
			const url = '/getReferenceNumber/' + referenceNoVal +'/'+statusCode;
			$.getJSON(url, function (data) {
				if(statusCode === "In_Transit"){
					createCardDeliveryTable(data);
				}
				else{
					createCardDeliveryTableDelivered(data);
				}
 				
 			});  
		}
		
	/* 	card In-Transit */
		function ajaxGetCardDeliveryDateBtn(start, end){
 			let startDate=start.format('YYYY-MM-DD');
 			let endDate=end.format('YYYY-MM-DD');
 			let statusCode ="In_Transit";	
 			const url = '/getReferenceNumber/date/'+startDate+'/'+endDate +'/'+statusCode;
 			$.getJSON(url, function (data) {
 				createCardDeliveryTable(data);
 			});
 		}

		/*  card delivered */
		function ajaxGetDeliveryDateBtn(start, end){
 			let startDate=start.format('YYYY-MM-DD');
 			let endDate=end.format('YYYY-MM-DD');
 			let statusCode ="Delivered";	
 			const url = '/getReferenceNumber/date/'+startDate+'/'+endDate +'/'+statusCode;
 			$.getJSON(url, function (data) {
				createCardDeliveryTableDelivered(data);
 			});
 		}
		/*  card delivered with branch */
		function ajaxGetDeliveryDateBtnBranch(start, end, destinationBranch){
 			let startDate=start.format('YYYY-MM-DD');
 			let endDate=end.format('YYYY-MM-DD');
 			let statusCode ="In_Transit";	
 			const url = '/getCardDelivered/date/'+startDate+'/'+endDate +'/'+statusCode +'/' + destinationBranch;
 			$.getJSON(url, function (data) {
				 createCardDeliveryTable(data);
 			});
 		}
		function ajaxGetDeliveryDateBtnBranchDelivered(start, end, destinationBranch){
 			let startDate=start.format('YYYY-MM-DD');
 			let endDate=end.format('YYYY-MM-DD');
 			let statusCode ="Delivered";	
 			const url = '/getCardDelivered/date/'+startDate+'/'+endDate +'/'+statusCode +'/' + destinationBranch;
 			$.getJSON(url, function (data) {
				createCardDeliveryTableDelivered(data);
 			});
 		}
		
 		function createCardDeliveryTable(data){
	         var table = $('#cardDelivery-table').DataTable({
	        	 "order": [ 1, "desc" ],
	        	 destroy: true,
	             "data": data,
	             select:"single",
	             "columns": [
	                 {
	                     "className": 'details-control',
	                     "orderable": false,
	                     "data": null,
	                     "defaultContent": '',
	                     "render": function () {
	                         return '<i class="ace-icon fa fa-angle-double-down fa-2x" title="Show details" aria-hidden="true"></i>';
	                     },
	                     width:"15px"
	                 },
	                { "data": "dispatchedDate",
	                	 "render" : function(data, type, row, meta) {
								if (data === null) return "";
								var thisDate = moment(new Date(data)).format("YYYY-MM-DD");
								return thisDate
							}
	                 },
	                 { "data": "referenceNumber" },
	                 { "data": "destinationBranch" },
	                { "data": "dispatchedMedium"
	                 },
	                 { "data": "detailsOfCourrierStaff" },
	                 { "data": "numberOfCardDispatched"
	                 },
	                 { "data": "numberOfPinDispatched" },
	                 { "data": "deliveryStatus" },
	                 { 	"className": 'view_data',
	                	"data": "null",
	                	"orderable": false,
		                	"render": function(data,type,row,meta) { // render event defines the markup of the cell text 
	 	                       var a = '<a class="btn btn-xs no-border btn-round btn-success" title="Click to enter Phase 2 details.">Phase 2 &nbsp;<i class="ace-icon fa fa-arrow-circle-right icon-on-right"  aria-hidden="true"></i></a>';
	 	                       return a;}
	                  }
	             ],             
	             dom: 'Blfrtip',
	             buttons: [
	            	 {
							"extend": "copy",
							"text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
							"className": "btn btn-white btn-primary btn-bold"
						  },
						  {
							"extend": "csv",
							"text": "<i class='fa fa-file-excel-o bigger-110 blue'></i> <span class='hidden'>Export to CSV</span>",
							"className": "btn btn-white btn-primary btn-bold"
						  },
						  {
							"extend": "excel",
							"text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
							"className": "btn btn-white btn-primary btn-bold",
							"exportOptions": { modifier: { page: 'all'} }
						  },
						  {
							"extend": "pdf",
							"text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
							"className": "btn btn-white btn-primary btn-bold",
							"exportOptions": { modifier: { page: 'all'} }
						  },
						  {
							"extend": "print",
							"text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
							"className": "btn btn-white btn-primary btn-bold",							
							autoPrint: false,
							orientation:'landscape',
							title: 'Card Delivery Record List  - (In Transit)'
						  }		  
	             ]
	            
	         });
	        
	         // Add event listener for opening and closing details
	         $('#cardDelivery-table tbody').on('click', 'td.details-control', function () {
	             var tr = $(this).closest('tr');
	             var tdi = tr.find("i.fa");
	             var row = table.row(tr);

	             if (row.child.isShown()) {
	                 // This row is already open - close it
	                 row.child.hide();
	                 tr.removeClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-up fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-down fa-2x');
	             }
	             else {
	                 // Open this row
	                 row.child(format(row.data())).show();
	                 tr.addClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-down fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-up fa-2x');
	             }
	         });

	         table.on("user-select", function (e, dt, type, cell, originalEvent) {
	             if ($(cell.node()).hasClass("details-control")) {
	                 e.preventDefault();
	             }
	         });
	         
	  	    function format(d){
	 	         // `d` is the original data object for the row
	 	         return '<table class="table table-striped table-bordered table-hover">' +
	 	        '<tr>' +
	             '<td width="25%"><strong>Reference Number: </strong></td>' +
	             '<td>' + d.referenceNumber + '</td>' +
	         '</tr>' +
	 	         '<tr>' +
                '<td width="20"><strong>Dispatched Date: </strong></td>' +
                '<td>' + moment(new Date(d.dispatchedDate)).format("YYYY-MM-DD") + '</td>' +
            	'</tr>' +
	 	             '<tr>' +
	 		             '<td width="25%"><strong>Destination Branch: </strong></td>' +
	 		             '<td>' + d.destinationBranch + '</td>' +
	 		         '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Dispatched Medium: </strong></td>' +
	 			         '<td>' + d.dispatchedMedium + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Details of Carrier/Staff: </strong></td>' +
	 			         '<td>' + d.detailsOfCourrierStaff + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Number of Card Dispatched: </strong></td>' +
	 			         '<td>' + d.numberOfCardDispatched + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Number of Pin Dispatched: </strong></td>' +
	 			         '<td>' + d.numberOfPinDispatched + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Delivery Status: </strong></td>' +
	 			         '<td>' + d.deliveryStatus + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Data Lodged By: </strong></td>' +
	 			         '<td>' + d.lodgedBy  + '</td>' +
	 			     '</tr>' +
			     
	 	         '</table>';  
	 	    }
	  	    
	         $('#cardDelivery-table tbody').on('click', 'td.view_data', function () {
	        	 var tr = $(this).closest('tr');
	             var row_val = table.row(tr);
	             var data_val= row_val.data();

	        	 
	        	 $("#idDetailVal").val(data_val.id);
	        	 $("#idDestBranchVal").val(data_val.destinationBranch);
	        	 $("#idDispDateVal").val(data_val.dispatchedDate);
	        	 $("#idDispMedVal").val(data_val.dispatchedMedium);
	        	 $("#idDetailStaffVal").val(data_val.detailsOfCourrierStaff);
	        	 $("#idNoCardVal").val(data_val.numberOfCardDispatched);
	        	 $("#idNoPinVal").val(data_val.numberOfPinDispatched);
	        	 $("#idDelStatusVal").val(data_val.deliveryStatus);
	        	 $("#idlodgedVal").val(data_val.lodgedBy);
	        	 $("#idRefNumberVal").val(data_val.referenceNumber);
	        	 
	             $('#myPhase2Modal').modal("show");
	             
	         });
		}
		
 		function createCardDeliveryTableDelivered(data){
	         var table = $('#cardDelivery-tableDelivered').DataTable({
	        	 "order": [ 1, "desc" ],
	        	 destroy: true,
	             "data": data,
	             select:"single",
	             "columns": [
	                 {
	                     "className": 'details-control',
	                     "orderable": false,
	                     "data": null,
	                     "defaultContent": '',
	                     "render": function () {
	                         return '<i class="ace-icon fa fa-angle-double-down fa-2x" title="Show details" aria-hidden="true"></i>';
	                     },
	                     width:"15px"
	                 },
	                { "data": "dispatchedDate",
	                	 "render" : function(data, type, row, meta) {
								if (data === null) return "";
								var thisDate = moment(new Date(data)).format("YYYY-MM-DD");
								return thisDate
							}
	                 },
	                 { "data": "referenceNumber" },
	                 { "data": "destinationBranch" },
	                { "data": "dispatchedMedium"
	                 },
	                 { "data": "detailsOfCourrierStaff" },
	                 { "data": "numberOfCardDispatched"
	                 },
	                 { "data": "numberOfPinDispatched" },
	                 { "data": "deliveryStatus" }
	          
	             ],             
	             dom: 'Blfrtip',
	             buttons: [
	            	 {
							"extend": "copy",
							"text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
							"className": "btn btn-white btn-primary btn-bold"
						  },
						  {
							"extend": "csv",
							"text": "<i class='fa fa-file-excel-o bigger-110 blue'></i> <span class='hidden'>Export to CSV</span>",
							"className": "btn btn-white btn-primary btn-bold"
						  },
						  {
							"extend": "excel",
							"text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
							"className": "btn btn-white btn-primary btn-bold",
							"exportOptions": { modifier: { page: 'all'} }
						  },
						  {
							"extend": "pdf",
							"text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
							"className": "btn btn-white btn-primary btn-bold",
							"exportOptions": { modifier: { page: 'all'} }
						  },
						  {
							"extend": "print",
							"text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
							"className": "btn btn-white btn-primary btn-bold",							
							autoPrint: false,
							orientation:'landscape',
							title: 'Card Delivery Record List - (Delivered)'
						  }		  
	             ]
	            
	         });
	        
	         // Add event listener for opening and closing details
	         $('#cardDelivery-tableDelivered tbody').on('click', 'td.details-control', function () {
	             var tr = $(this).closest('tr');
	             var tdi = tr.find("i.fa");
	             var row = table.row(tr);

	             if (row.child.isShown()) {
	                 // This row is already open - close it
	                 row.child.hide();
	                 tr.removeClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-up fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-down fa-2x');
	             }
	             else {
	                 // Open this row
	                 row.child(format(row.data())).show();
	                 tr.addClass('shown');
	                 tdi.first().removeClass('fa fa-angle-double-down fa-2x');
	                 tdi.first().addClass('fa fa-angle-double-up fa-2x');
	             }
	         });

	         table.on("user-select", function (e, dt, type, cell, originalEvent) {
	             if ($(cell.node()).hasClass("details-control")) {
	                 e.preventDefault();
	             }
	         });
	         
	  	    function format(d){
	 	         // `d` is the original data object for the row
	 	         return '<table class="table table-striped table-bordered table-hover">' +
	 	        '<tr>' +
	             '<td width="25%"><strong>Reference Number: </strong></td>' +
	             '<td>' + d.referenceNumber + '</td>' +
	         '</tr>' +
	 	         '<tr>' +
                '<td width="20"><strong>Dispatched Date: </strong></td>' +
                '<td>' + moment(new Date(d.dispatchedDate)).format("YYYY-MM-DD") + '</td>' +
            	'</tr>' +
	 	             '<tr>' +
	 		             '<td width="25%"><strong>Destination Branch: </strong></td>' +
	 		             '<td>' + d.destinationBranch + '</td>' +
	 		         '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Dispatched Medium: </strong></td>' +
	 			         '<td>' + d.dispatchedMedium + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Details of Carrier/Staff: </strong></td>' +
	 			         '<td>' + d.detailsOfCourrierStaff + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Number of Card Dispatched: </strong></td>' +
	 			         '<td>' + d.numberOfCardDispatched + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Number of Pin Dispatched: </strong></td>' +
	 			         '<td>' + d.numberOfPinDispatched + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Delivery Status: </strong></td>' +
	 			         '<td>' + d.deliveryStatus + '</td>' +
	 			     '</tr>' +
	 		         '<tr>' +
	 			         '<td width="25%"><strong>Data Lodged By: </strong></td>' +
	 			         '<td>' + d.lodgedBy  + '</td>' +
	 			     '</tr>' +
			     
	 	         '</table>';  
	 	    }
	
		}
		
		</script>
	</th:block>
</body>
</html>